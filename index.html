<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校园植被身份证 | 探索校园植物世界</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&family=Caveat:wght@400;600;700&display=swap"
          rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- 引入百度地图API -->
    <script type="text/javascript"
            src="https://api.map.baidu.com/api?v=3.0&ak=gKRg5w1OdVa4hkexo2mXWNT7A1OPAtsw"></script>

    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2E7D32',
                        secondary: '#4CAF50',
                        accent: '#8BC34A',
                        neutral: '#F5F5F5',
                        dark: '#212121',
                        vintage: {
                            paper: '#f8f6f0',
                            brown: '#5a4634',
                            lightBrown: '#7d6b56',
                            gold: '#a68a64',
                            lightGold: '#e8e0d0'
                        }
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                        playfair: ['Playfair Display', 'serif'],
                        caveat: ['Caveat', 'cursive']
                    },
                },
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            /* 确保移动端菜单链接始终为黑色 */
            #mobileMenu a {
                color: #212121 !important;
            }

            #mobileMenu a:hover {
                color: #2E7D32 !important;
            }
            .content-auto {
                content-visibility: auto;
            }

            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .card-hover {
                transition: all 0.3s ease;
            }

            .card-hover:hover {
                transform: translateY(-5px);
            }

            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }

            .gradient-overlay {
                background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 100%);
            }

            .img-preview-transition {
                transition: opacity 0.3s ease;
            }

            .map-marker {
                transition: all 0.2s ease;
            }

            .map-marker:hover {
                transform: scale(1.2);
            }

            .animate-pulse-slow {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }

            .dropzone {
                border: 2px dashed #d1d5db;
                border-radius: 0.5rem;
                padding: 1.5rem;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .dropzone:hover, .dropzone.dragover {
                border-color: #2E7D32;
                background-color: rgba(46, 125, 50, 0.05);
            }

            .dropzone.dragover {
                transform: scale(1.02);
            }

            .preview-image {
                width: 100%;
                height: 120px;
                object-fit: cover;
                border-radius: 0.5rem;
                margin-bottom: 0.5rem;
            }

            .preview-container {
                position: relative;
                display: inline-block;
                margin: 0.5rem;
                width: calc(33.333% - 1rem);
            }

            .preview-remove {
                position: absolute;
                top: -0.5rem;
                right: -0.5rem;
                background: rgba(0, 0, 0, 0.7);
                color: white;
                border-radius: 50%;
                width: 1.5rem;
                height: 1.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                font-size: 0.8rem;
            }

            .map-selector {
                position: relative;
                height: 400px;
                overflow: hidden;
                border-radius: 0.5rem;
                background-color: #f9fafb;
            }

            .map-selector .map-marker-select {
                position: absolute;
                width: 24px;
                height: 24px;
                background-color: #2E7D32;
                border-radius: 50%;
                border: 3px solid white;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
                cursor: pointer;
                transform: translate(-50%, -50%);
                z-index: 10;
            }

            .map-selector .map-marker-select:hover {
                transform: translate(-50%, -50%) scale(1.2);
            }

            .admin-actions {
                display: flex;
                gap: 0.5rem;
                margin-top: 1rem;
            }

            .admin-actions button {
                flex: 1;
                padding: 0.5rem 1rem;
                border-radius: 0.375rem;
                font-size: 0.875rem;
                transition: all 0.2s;
            }

            .image-preview-options {
                display: flex;
                gap: 0.5rem;
                margin-top: 0.5rem;
            }

            .image-preview-options button {
                flex: 1;
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                font-size: 0.75rem;
                background-color: #f3f4f6;
                border: 1px solid #d1d5db;
                transition: all 0.2s;
            }

            .image-preview-options button.active {
                background-color: #2E7D32;
                color: white;
                border-color: #2E7D32;
            }

            .pagination {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 1rem;
            }

            .pagination-info {
                font-size: 0.875rem;
                color: #6b7280;
            }

            .pagination-controls {
                display: flex;
                gap: 0.5rem;
            }

            .pagination-btn {
                width: 2rem;
                height: 2rem;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 1px solid #d1d5db;
                border-radius: 0.375rem;
                background-color: white;
                cursor: pointer;
                transition: all 0.2s;
            }

            .pagination-btn:hover:not(:disabled) {
                background-color: #f3f4f6;
            }

            .pagination-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .rotated-image {
                transform: rotate(90deg);
            }

            .page-number {
                width: 2rem;
                height: 2rem;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 1px solid #d1d5db;
                border-radius: 0.375rem;
                background-color: white;
                cursor: pointer;
                transition: all 0.2s;
                font-size: 0.875rem;
            }

            .page-number.active {
                background-color: #2E7D32;
                color: white;
                border-color: #2E7D32;
            }

            .page-number:hover:not(.active) {
                background-color: #f3f4f6;
            }

            /* 修复百度地图容器样式 */
            #baidu-map-container {
                height: 600px;
                width: 100%;
                position: relative;
                border-radius: 0.5rem;
                overflow: hidden;
                z-index: 1;
            }

            /* 地图图例样式 */
            .map-legend-container {
                position: absolute;
                bottom: 50px;
                left: 25px;
                z-index: 40;
                pointer-events: none;
            }

            .map-legend {
                background: rgba(255, 255, 255, 0.95);
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                backdrop-filter: blur(5px);
                border: none;
                min-width: 150px;
                pointer-events: auto;
            }

            /* 自定义百度地图标记样式 */
            .baidu-marker {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                color: white;
                border: none !important;
                transition: transform 0.2s ease;
            }

            .baidu-marker:hover {
                transform: scale(1.2);
            }

            .baidu-marker-tree {
                background-color: #2E7D32;
            }

            .baidu-marker-shrub {
                background-color: #4CAF50;
            }

            .baidu-marker-herb {
                background-color: #8BC34A;
            }

            .baidu-marker-vine {
                background-color: #CDDC39;
            }

            .baidu-marker-fern {
                background-color: #FFC107;
            }

            .baidu-info-window {
                padding: 10px;
                max-width: 280px;
                min-width: 250px;
            }

            .baidu-info-window-content {
                display: flex;
                gap: 10px;
                align-items: flex-start;
            }

            .baidu-info-window-text {
                flex: 1;
                min-width: 0;
            }

            .baidu-info-window-image {
                width: 80px;
                height: 80px;
                object-fit: cover;
                border-radius: 4px;
                flex-shrink: 0;
            }

            .baidu-info-window h3 {
                margin: 0 0 5px 0;
                font-size: 16px;
                font-weight: bold;
                color: #2E7D32;
            }

            .baidu-info-window p {
                margin: 0 0 5px 0;
                font-size: 14px;
                color: #666;
            }

            .baidu-info-window button {
                background-color: #2E7D32;
                color: white;
                border: none;
                padding: 5px 10px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
                margin-top: 5px;
                width: 100%;
            }


            .BMap_noprint.anchorTL {
                z-index: 1001 !important;
            }

            .BMap_noprint.anchorBL {
                z-index: 1001 !important;
            }

            .BMap_noprint.anchorTR {
                z-index: 1001 !important;
            }

            .plant-type {
                border: none !important;
                box-shadow: none !important;
                outline: none !important;
            }

            /* 移除所有可能的外边框 */
            .BMapLabel {
                border: none !important;
                background: none !important;
            }

            /* 植物详情模态框新样式 */
            .specimen-detail {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 1000;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .specimen-detail.active {
                display: flex;
            }

            .detail-container {
                background: #fffdf5;
                border: 2px solid #a68a64;
                max-width: 900px;
                width: 100%;
                max-height: 90vh;
                overflow-y: auto;
                position: relative;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                border-radius: 12px;
            }

            .detail-header {
                padding: 25px 30px 15px;
                border-bottom: 2px solid #a68a64;
                background: rgba(255, 253, 245, 0.9);
                position: relative;
            }

            .detail-title {
                font-family: 'Playfair Display', serif;
                font-size: 2.5rem;
                font-weight: 700;
                color: #5a4634;
                margin-bottom: 5px;
            }

            .detail-subtitle {
                font-style: italic;
                color: #795548;
                font-size: 1.3rem;
            }

            .close-btn {
                position: absolute;
                top: 20px;
                right: 20px;
                background: #a68a64;
                color: #fffdf5;
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 1.5rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
            }

            .close-btn:hover {
                background: #8a7256;
                transform: rotate(90deg);
            }

            .detail-content {
                padding: 30px;
            }

            .detail-top {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
                margin-bottom: 25px;
                align-items: start;
            }

            .detail-image-container {
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: transform 0.3s ease;
            }

            .detail-image-container:hover {
                transform: scale(1.02);
            }

            .detail-image {
                width: 100%;
                max-height: 400px;
                object-fit: cover;
                border: 2px solid #a68a64;
                border-radius: 8px;
                filter: sepia(0.3) contrast(1.1);
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .detail-image:hover {
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            }

            .detail-info {
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }

            .detail-info h3 {
                font-size: 1.8rem;
                color: #5a4634;
                margin-bottom: 15px;
                border-bottom: 1px dashed #a68a64;
                padding-bottom: 5px;
            }

            .info-item {
                margin-bottom: 12px;
                display: flex;
            }

            .info-label {
                font-weight: 600;
                width: 100px;
                color: #a68a64;
            }

            .info-value {
                flex: 1;
                color: #5a4037;
            }

            .description {
                line-height: 1.7;
                color: #5a4037;
                padding: 20px;
                background: rgba(166, 138, 100, 0.1);
                border-left: 3px solid #a68a64;
                border-radius: 0 8px 8px 0;
                margin-bottom: 25px;
                font-size: 1.2rem;
            }

            .map-section {
                margin-top: 20px;
            }

            .map-container {
                height: 300px;
                border: 2px solid #a68a64;
                border-radius: 8px;
                overflow: hidden;
                margin-top: 10px;
            }

            .more-photos-section {
                margin-top: 25px;
                padding-top: 20px;
                border-top: 1px solid #e0e0e0;
            }

            .more-photos-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
                margin-top: 15px;
            }

            .more-photo-item {
                position: relative;
                border-radius: 8px;
                overflow: hidden;
                cursor: pointer;
                transition: all 0.3s ease;
                aspect-ratio: 4/3;
            }

            .more-photo-item:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            }

            .more-photo-img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                border: 2px solid #a68a64;
                border-radius: 8px;
                filter: sepia(0.2) contrast(1.05);
            }

            .more-photo-item:hover .more-photo-img {
                filter: sepia(0) contrast(1.1);
            }

            .pin {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 20px;
                height: 20px;
                background: #c62828;
                border-radius: 50%;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }

            .pin::after {
                content: '';
                position: absolute;
                top: -8px;
                left: 5px;
                width: 10px;
                height: 10px;
                background: #c62828;
                clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            }

            /* 详情图片放大预览样式 */
            .detail-image-preview {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.95);
                z-index: 1100;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 40px;
            }

            .detail-image-preview.active {
                display: flex;
            }

            .detail-image-preview-content {
                position: relative;
                max-width: 90%;
                max-height: 90%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .detail-image-preview-img {
                max-width: 100%;
                max-height: 100%;
                object-fit: contain;
                border-radius: 8px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }

            .detail-image-preview-close {
                position: absolute;
                top: -40px;
                right: -40px;
                width: 40px;
                height: 40px;
                background: rgba(255, 255, 255, 0.2);
                color: white;
                border: none;
                border-radius: 50%;
                font-size: 1.5rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
            }

            .detail-image-preview-close:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: rotate(90deg);
            }

            .detail-image-preview-info {
                position: absolute;
                bottom: -60px;
                left: 0;
                right: 0;
                text-align: center;
                color: white;
                font-size: 1rem;
                padding: 10px;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 4px;
                backdrop-filter: blur(5px);
            }

            /* 轮播图样式 */
            .carousel-container {
                position: relative;
                overflow: hidden;
                width: 100%;
                height: 100%;
                border-radius: 0.75rem;
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }

            .carousel-slide {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                opacity: 0;
                transition: opacity 0.5s ease-in-out;
                border-radius: 0.75rem;
            }

            .carousel-slide.active {
                opacity: 1;
                z-index: 1;
            }

            .carousel-slide img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                border-radius: 0.75rem;
            }

            .carousel-indicator {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background-color: rgba(46, 125, 50, 0.5);
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .carousel-indicator.active {
                background-color: #2E7D32;
                width: 30px;
                border-radius: 5px;
            }

            /* 优化图片上传区域样式 */
            .upload-preview-container {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 15px;
            }

            .upload-preview-item {
                position: relative;
                width: 100px;
                height: 100px;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .upload-preview-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .upload-preview-remove {
                position: absolute;
                top: 5px;
                right: 5px;
                width: 20px;
                height: 20px;
                background: rgba(0, 0, 0, 0.7);
                color: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .upload-preview-remove:hover {
                background: rgba(0, 0, 0, 0.9);
                transform: scale(1.1);
            }

            .upload-status {
                margin-top: 10px;
                font-size: 14px;
                color: #666;
            }

            .form-section {
                background: #f8f9fa;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 20px;
            }

            .form-section-title {
                font-size: 16px;
                font-weight: 600;
                color: #2E7D32;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
            }

            .form-section-title i {
                margin-right: 8px;
            }

            /* 二维码预览模态框样式 */
            .qrcode-preview {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.95);
                z-index: 1100;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 40px;
            }

            .qrcode-preview.active {
                display: flex;
            }

            .qrcode-preview-content {
                position: relative;
                max-width: 90%;
                max-height: 90%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background: white;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }

            .qrcode-preview-img {
                max-width: 300px;
                max-height: 300px;
                object-fit: contain;
                border-radius: 8px;
                margin-bottom: 20px;
            }

            .qrcode-preview-title {
                font-size: 1.5rem;
                font-weight: bold;
                color: #2E7D32;
                margin-bottom: 10px;
                text-align: center;
            }

            .qrcode-preview-desc {
                font-size: 1rem;
                color: #666;
                text-align: center;
                margin-bottom: 20px;
            }

            .qrcode-preview-close {
                position: absolute;
                top: 15px;
                right: 15px;
                width: 40px;
                height: 40px;
                background: rgba(0, 0, 0, 0.1);
                color: #333;
                border: none;
                border-radius: 50%;
                font-size: 1.5rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
            }

            .qrcode-preview-close:hover {
                background: rgba(0, 0, 0, 0.2);
                transform: rotate(90deg);
            }

            .qrcode-preview-info {
                text-align: center;
                color: #999;
                font-size: 0.9rem;
                margin-top: 15px;
            }
            /* 成功提示动画 */
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }

            /* 进度条动画 */
            @keyframes progressBar {
                0% {
                    width: 100%;
                }
                100% {
                    width: 0%;
                }
            }

            .progress-bar {
                animation: progressBar 2s linear forwards;
            }
        }
    </style>
</head>

<body class="font-inter bg-gray-50 text-dark">
<!-- 导航栏 -->
<header id="navbar" class="fixed w-full z-50 transition-all duration-300 bg-transparent">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center space-x-2">
            <button id="userAvatar" class="flex items-center focus:outline-none mr-2">
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center border border-white/30">
                    <i class="fa fa-user text-white text-sm"></i>
                </div>
            </button>
            <a href="#" class="flex items-center">
                <span class="text-xl font-bold text-white text-shadow">校园植被身份证</span>
            </a>
        </div>

        <!-- 桌面导航 - 保持原有位置不变 -->
        <nav class="hidden md:flex items-center space-x-8">
            <a href="#home" class="text-white hover:text-accent transition-colors">首页</a>
            <a href="#plants" class="text-white hover:text-accent transition-colors">植物图鉴</a>
            <a href="#map" class="text-white hover:text-accent transition-colors">植被地图</a>
            <a href="#admin" class="text-white hover:text-accent transition-colors admin-nav-link" style="display: none;">植物管理</a>
        </nav>

        <!-- 搜索按钮 - 保持原有位置不变 -->
        <button id="searchBtn" class="hidden md:block text-white hover:text-accent transition-colors">
            <i class="fa fa-search text-xl"></i>
        </button>

        <!-- 移动端菜单按钮 - 保持原有位置不变 -->
        <button id="menuBtn" class="md:hidden text-white text-2xl">
            <i class="fa fa-bars"></i>
        </button>
    </div>

    <!-- 移动端菜单 -->
    <div id="mobileMenu"
         class="md:hidden bg-white shadow-lg absolute w-full left-0 top-full transform -translate-y-full opacity-0 transition-all duration-300 pointer-events-none">
        <div class="container mx-auto px-4 py-3 flex flex-col space-y-4">
            <a href="#home" class="py-2 border-b border-gray-100 hover:text-primary transition-colors">首页</a>
            <a href="#plants" class="py-2 border-b border-gray-100 hover:text-primary transition-colors">植物图鉴</a>
            <a href="#map" class="py-2 border-b border-gray-100 hover:text-primary transition-colors">植被地图</a>
            <a href="#admin" class="py-2 hover:text-primary transition-colors admin-nav-link-mobile" style="display: none;">植物管理</a>

            <!-- 移动端搜索框 -->
            <div class="relative">
                <input type="text" placeholder="搜索植物名称、学名..."
                       class="w-full py-2 px-4 pr-10 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/50"
                       id="mobileSearchInput">
                <i class="fa fa-search absolute right-3 top-3 text-gray-400"></i>
            </div>
        </div>
    </div>
</header>

<!-- 搜索模态框 -->
<div id="searchModal"
     class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="bg-white rounded-xl w-full max-w-2xl mx-4 p-6 transform scale-95 transition-transform duration-300">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold">搜索植物</h3>
            <button id="closeSearch" class="text-gray-500 hover:text-gray-700">
                <i class="fa fa-times text-xl"></i>
            </button>
        </div>
        <div class="relative">
            <input type="text" placeholder="输入植物名称、学名、科属或特征..."
                   class="w-full py-3 px-4 pr-10 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/50 text-lg"
                   id="modalSearchInput">
            <i class="fa fa-search absolute right-3 top-4 text-gray-400"></i>
        </div>
        <div class="mt-4">
            <h4 class="text-sm font-medium text-gray-500 mb-2">热门搜索</h4>
            <div class="flex flex-wrap gap-2">
                <span class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200 cursor-pointer transition-colors search-tag">垂柳</span>
                <span class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200 cursor-pointer transition-colors search-tag">海棠</span>
                <span class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200 cursor-pointer transition-colors search-tag">月季</span>
                <span class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200 cursor-pointer transition-colors search-tag">莲</span>
                <span class="px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200 cursor-pointer transition-colors search-tag">水杉</span>
            </div>
        </div>
    </div>
</div>

<!-- 英雄区域 -->
<section id="home" class="min-h-screen flex items-center bg-gradient-to-br from-green-400 to-green-600 pt-16">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="flex flex-col md:flex-row items-center h-full">
            <div class="md:w-1/2 mb-10 md:mb-0">
                <h1 class="text-[clamp(2.5rem,6vw,4.5rem)] font-bold text-dark leading-tight mb-6">
                    探索校园植物<br class="md:hidden">奇妙世界
                </h1>
                <p class="text-[clamp(1rem,2vw,1.25rem)] text-gray-600 max-w-2xl mb-8">
                    通过校园植被身份证系统，了解每一株植物的故事，发现身边的自然之美
                </p>
                <div class="flex flex-col sm:flex-row gap-4">
                    <a href="#plants"
                       class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-full transition-all shadow-lg hover:shadow-xl">
                        浏览植物图鉴
                    </a>
                    <a href="#map"
                       class="bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white font-medium py-3 px-8 rounded-full transition-all border border-white/40">
                        查看植被地图
                    </a>
                </div>
            </div>

            <!-- 轮播图容器  -->
            <div class="md:w-1/2 w-full" style="height: 60vh; max-height: 400px;">
                <div class="carousel-container rounded-xl shadow-xl transform rotate-1 hover:rotate-0 transition-transform duration-500">
                    <!-- 轮播图片将通过JavaScript动态生成 -->
                </div>
                <!-- 轮播指示器 -->
                <div id="carousel-indicators" class="flex justify-center mt-4 gap-2">
                    <!-- 指示器将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 text-dark animate-bounce">
            <a href="#intro" class="flex flex-col items-center">
                <span class="mb-2 text-sm">向下探索</span>
                <i class="fa fa-chevron-down"></i>
            </a>
        </div>
    </div>
</section>

<!-- 简介部分 -->
<section id="intro" class="py-20 bg-white">
    <div class="container mx-auto px-4">
        <div class="text-center mb-16">
            <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-dark mb-4">校园植被身份证项目</h2>
            <p class="text-gray-600 max-w-3xl mx-auto text-lg">
                记录校园内的每一种植物，建立数字化的植物档案，让师生更深入地了解和保护校园生态环境</p>
        </div>

        <div class="grid md:grid-cols-3 gap-8">
            <div class="bg-neutral rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow text-center">
                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fa fa-book text-2xl text-primary"></i>
                </div>
                <h3 class="text-xl font-semibold mb-3">植物档案库</h3>
                <p class="text-gray-600">建立完整的植物信息数据库，包含学名、俗名、科属、特征、生长环境等详细资料</p>
            </div>

            <div class="bg-neutral rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow text-center">
                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fa fa-map-marker text-2xl text-primary"></i>
                </div>
                <h3 class="text-xl font-semibold mb-3">位置定位</h3>
                <p class="text-gray-600">标注每种植物在校园内的具体位置，方便师生查找和实地观察学习</p>
            </div>

            <div class="bg-neutral rounded-xl p-8 shadow-sm hover:shadow-md transition-shadow text-center">
                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fa fa-graduation-cap text-2xl text-primary"></i>
                </div>
                <h3 class="text-xl font-semibold mb-3">教育价值</h3>
                <p class="text-gray-600">提供丰富的植物知识，成为生物、环境等学科的户外教学资源</p>
            </div>
        </div>

        <div class="mt-16 bg-primary/5 rounded-2xl p-8 md:p-12">
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div>
                    <h3 class="text-2xl font-bold mb-4">校园植物统计</h3>
                    <p class="text-gray-600 mb-6">目前我们已记录校园内<span id="total-plants-count">0</span>种植物，涵盖乔木、灌木、草本、藤本和蕨类等多种类型。
                    </p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-3xl font-bold text-primary mb-1" id="total-plants-display">0</div>
                            <div class="text-gray-600">植物种类</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-primary mb-1">5</div>
                            <div class="text-gray-600">植物类别</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-primary mb-1" id="trees-count">0</div>
                            <div class="text-gray-600">乔木种类</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-primary mb-1" id="shrubs-count">0</div>
                            <div class="text-gray-600">灌木种类</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-primary mb-1" id="herbs-count">0</div>
                            <div class="text-gray-600">草本植物</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-primary mb-1" id="vines-count">0</div>
                            <div class="text-gray-600">藤本与蕨类</div>
                        </div>
                    </div>
                </div>
                <div class="h-64">
                    <canvas id="plantChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 植物图鉴部分 -->
<section id="plants" class="py-20 bg-neutral">
    <div class="container mx-auto px-4">
        <div class="text-center mb-12">
            <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-dark mb-4">校园植物图鉴</h2>
            <p class="text-gray-600 max-w-3xl mx-auto">探索校园内丰富多样的植物种类，了解它们的特征和生长习性</p>
        </div>

        <!-- 搜索与分类栏 -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-8">
            <!-- 左侧搜索框 -->
            <div class="relative w-full sm:w-1/3">
                <input type="text" placeholder="搜索植物名称、学名、科属..."
                       class="w-full py-2 pl-10 pr-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all"
                       id="plantSearchInput">
                <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>

            <!-- 右侧分类按钮 -->
            <div class="flex flex-wrap gap-2 w-full sm:w-auto justify-start sm:justify-end">
                <button class="px-4 py-2 bg-primary text-white rounded-lg text-sm transition-colors filter-btn active"
                        data-filter="all">全部植物
                </button>
                <button class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors filter-btn"
                        data-filter="乔木">乔木
                </button>
                <button class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors filter-btn"
                        data-filter="灌木">灌木
                </button>
                <button class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors filter-btn"
                        data-filter="草本">草本
                </button>
                <button class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors filter-btn"
                        data-filter="藤本">藤本
                </button>
                <button class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors filter-btn"
                        data-filter="蕨类">蕨类
                </button>
            </div>
        </div>

        <!-- 植物卡片网格 -->
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6" id="plantsGrid">
            <!-- 植物卡片将通过JavaScript动态生成 -->
        </div>

        <!-- 没有结果时显示 -->
        <div id="noResults" class="hidden text-center py-16">
            <i class="fa fa-search text-5xl text-gray-300 mb-4"></i>
            <p class="text-gray-500">没有找到匹配的植物，请尝试其他关键词或分类</p>
        </div>

        <!-- 加载更多按钮 -->
        <div class="text-center mt-12">
            <button class="bg-white border border-primary text-primary hover:bg-primary hover:text-white font-medium py-3 px-8 rounded-full transition-all"
                    id="loadMoreBtn">
                加载更多植物 <i class="fa fa-angle-down ml-1"></i>
            </button>
        </div>
    </div>
</section>

<!-- 植物详情模态框 -->
<div id="specimen-detail" class="specimen-detail">
    <div class="detail-container">
        <div class="pin"></div>
        <div class="detail-header">
            <button class="close-btn" id="close-detail">×</button>
            <h2 class="detail-title" id="detail-title">植物名称</h2>
            <p class="detail-subtitle" id="detail-subtitle">拉丁学名</p>
        </div>
        <div class="detail-content">
            <div class="detail-top">
                <div class="detail-image-container" id="detail-image-container">
                    <img src="" alt="" class="detail-image" id="detail-image">
                </div>
                <div class="detail-info">
                    <div>
                        <h3>植物信息</h3>
                        <div class="info-item">
                            <span class="info-label">科：</span>
                            <span class="info-value" id="info-family">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">属：</span>
                            <span class="info-value" id="info-genus">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">分布：</span>
                            <span class="info-value" id="info-distribution">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">环境：</span>
                            <span class="info-value" id="info-environment">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">采集时间：</span>
                            <span class="info-value" id="info-collection-date">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="description" id="info-description">
                -
            </div>

            <div class="map-section">
                <h3>分布地图</h3>
                <div id="mini-map" class="map-container"></div>
            </div>

            <!-- 新增：更多照片区域 -->
            <div class="more-photos-section" id="more-photos-section" style="display: none;">
                <h3>更多照片</h3>
                <div class="more-photos-grid" id="more-photos-grid">
                    <!-- 更多照片将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 详情图片放大预览模态框 -->
<div id="detail-image-preview" class="detail-image-preview">
    <div class="detail-image-preview-content">
        <img id="detail-image-preview-img" src="" alt="植物大图预览" class="detail-image-preview-img">
        <button id="detail-image-preview-close" class="detail-image-preview-close">×</button>
        <div class="detail-image-preview-info">
            点击任意位置或按ESC键关闭预览
        </div>
    </div>
</div>

<!-- 图片全屏预览模态框 -->
<div id="image-preview-modal" class="fixed inset-0 bg-black/95 z-[100] hidden flex items-center justify-center p-4">
    <div class="relative max-w-6xl w-full h-full flex items-center justify-center">
        <img id="fullscreen-image" src="" alt="植物大图预览"
             class="max-w-full max-h-[90vh] object-contain opacity-0 transition-opacity duration-300">
        <button id="close-image-preview"
                class="absolute top-4 right-4 w-10 h-10 bg-black/50 text-white rounded-full flex items-center justify-center hover:bg-black/70 transition-colors">
            <i class="fa fa-times text-xl"></i>
        </button>
        <div class="absolute bottom-4 left-0 right-0 text-center text-white text-sm">
            点击X或按ESC键关闭
        </div>
    </div>
</div>

<!-- 校园植被地图（百度地图版本） -->
<section id="map" class="py-20 bg-white">
    <div class="container mx-auto px-4">
        <div class="text-center mb-12">
            <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-dark mb-4">校园植被地图</h2>
            <p class="text-gray-600 max-w-3xl mx-auto">探索校园内各类植物的分布情况，规划你的植物观察路线</p>
        </div>

        <div class="bg-neutral rounded-xl overflow-hidden shadow-sm">
            <!-- 百度地图容器 -->
            <div class="relative">
                <div class="map-legend-container">
                    <div class="map-legend">
                        <h3 class="font-semibold mb-3">植物类型</h3>
                        <div class="grid grid-cols-2 gap-2" id="map-legend">
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-primary mr-2"></div>
                                <span class="text-sm">乔木</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-secondary mr-2"></div>
                                <span class="text-sm">灌木</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-accent mr-2"></div>
                                <span class="text-sm">草本</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-yellow-500 mr-2"></div>
                                <span class="text-sm">藤本</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-purple-500 mr-2"></div>
                                <span class="text-sm">蕨类</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="baidu-map-container">
                    <!-- 地图将在这里渲染 -->
                </div>
            </div>

            <!-- 地图下方内容区域 -->
            <div class="p-6 relative z-10 bg-neutral">
                <div class="flex flex-wrap gap-4 mb-6">
                    <button class="px-4 py-2 bg-primary text-white rounded-full text-sm flex items-center transition-colors filter-map-btn active"
                            data-filter="all">
                        <i class="fa fa-crosshairs mr-2"></i> 显示所有植物
                    </button>
                    <button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-sm flex items-center transition-colors filter-map-btn"
                            data-filter="乔木">
                        <i class="fa fa-tree mr-2 text-primary"></i> 只看乔木
                    </button>
                    <button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-sm flex items-center transition-colors filter-map-btn"
                            data-filter="灌木">
                        <i class="fa fa-pagelines mr-2 text-secondary"></i> 只看灌木
                    </button>
                    <button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-sm flex items-center transition-colors filter-map-btn"
                            data-filter="草本">
                        <i class="fa fa-leaf mr-2 text-accent"></i> 只看草本
                    </button>
                    <button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-sm flex items-center transition-colors filter-map-btn"
                            data-filter="藤本">
                        <i class="fa fa-vine mr-2 text-yellow-500"></i> 只看藤本
                    </button>
                    <button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-sm flex items-center transition-colors filter-map-btn"
                            data-filter="蕨类">
                        <i class="fa fa-pagelines mr-2 text-purple-500"></i> 只看蕨类
                    </button>
                </div>

                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <h3 class="font-semibold mb-2">植物分布最多的区域</h3>
                        <ol class="space-y-2 text-gray-600" id="top-locations">
                            <!-- 植物分布区域将通过JavaScript动态生成 -->
                        </ol>
                    </div>

                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <h3 class="font-semibold mb-2">植物观察推荐路线</h3>
                        <ul class="space-y-2 text-gray-600">
                            <li class="flex items-start">
                                <i class="fa fa-map-signs text-primary mt-1 mr-2"></i>
                                <span>东门 → 操场 → 校园主干路 → 图书馆 → 梅花食堂 → 西湖周边 → 文思园</span>
                            </li>
                        </ul>
                    </div>

                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <h3 class="font-semibold mb-2">当前季节推荐植物</h3>
                        <div class="flex flex-wrap gap-2" id="seasonal-plants">
                            <!-- 季节性植物将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 植物管理部分 - 只有管理员可见 -->
<section id="admin" class="py-20 bg-neutral" style="display: none;">
    <div class="container mx-auto px-4">
        <div class="text-center mb-12">
            <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-dark mb-4">植物管理</h2>
            <p class="text-gray-600 max-w-3xl mx-auto">添加、编辑或删除校园植被信息，维护最新的校园植物数据库</p>
        </div>

        <!-- 植物管理操作区域 -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold">植被信息管理</h3>
                <button id="addPlantBtn"
                        class="px-4 py-2 bg-primary text-white rounded-lg font-medium flex items-center transition-colors hover:bg-primary/90">
                    <i class="fa fa-plus mr-2"></i> 添加新植被
                </button>
            </div>

            <!-- 植物列表表格 -->
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-100 text-gray-700">
                    <tr>
                        <th class="px-4 py-3">ID</th>
                        <th class="px-4 py-3">名称</th>
                        <th class="px-4 py-3">类别</th>
                        <th class="px-4 py-3">分布区域</th>
                        <th class="px-4 py-3">创建者</th>
                        <th class="px-4 py-3">操作</th>
                    </tr>
                    </thead>
                    <tbody id="plantTableBody">
                    <!-- 植物数据将通过JavaScript动态加载 -->
                    </tbody>
                </table>
            </div>

            <!-- 分页信息 -->
            <div class="pagination">
                <div class="pagination-info">显示 1-5 项，共 <span id="total-plants-count">0</span> 项</div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="prevPageBtn" disabled>
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <div id="pageNumbers" class="flex gap-1">
                        <!-- 页码将通过JavaScript动态生成 -->
                    </div>
                    <button class="pagination-btn" id="nextPageBtn">
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 植物管理模态框 -->
<div id="plantManagementModal"
     class="fixed inset-0 bg-black/70 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="bg-white rounded-xl w-full max-w-4xl max-h-[90vh] overflow-auto mx-4 transform scale-95 transition-transform duration-300">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold" id="managementModalTitle">添加新植被</h3>
                <button id="closeManagementModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>

            <form id="plantDataForm">
                <!-- 图片上传和基本信息区域 -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fa fa-image"></i> 植物图片
                    </div>
                    <div class="flex flex-col md:flex-row gap-6">
                        <!-- 左侧：图片上传区域 -->
                        <div class="flex-1">
                            <div class="dropzone" id="imageDropzone">
                                <div class="flex flex-col items-center py-4">
                                    <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-gray-600 font-medium mb-1">点击或拖拽图片到此处上传</p>
                                    <p class="text-sm text-gray-500">支持 JPG, PNG, WEBP 格式，建议尺寸 800x600 像素</p>
                                </div>
                                <input type="file" id="imageUpload" class="hidden" multiple accept="image/*">
                            </div>

                            <!-- 上传状态 -->
                            <div id="uploadStatus" class="upload-status">
                                <span id="uploadCount">0</span> 张图片已选择
                            </div>
                        </div>

                        <!-- 右侧：图片预览区域 -->
                        <div class="flex-1">
                            <div id="imagePreview" class="upload-preview-container">
                                <!-- 图片预览将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 基本信息区域 - 整合后的布局 -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fa fa-info-circle"></i> 基本信息
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <!-- 第一行 -->
                        <div class="mb-4">
                            <label for="plantName" class="block text-sm font-medium text-gray-700 mb-1">植物名称
                                *</label>
                            <input type="text" id="plantName"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                   placeholder="请输入植物中文名称" required>
                        </div>

                        <div class="mb-4">
                            <label for="plantScientific"
                                   class="block text-sm font-medium text-gray-700 mb-1">拉丁学名</label>
                            <input type="text" id="plantScientific"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                   placeholder="请输入植物拉丁学名">
                        </div>

                        <!-- 第二行 -->
                        <div class="mb-4">
                            <label for="plantCategory" class="block text-sm font-medium text-gray-700 mb-1">植物类别
                                *</label>
                            <select id="plantCategory"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    required>
                                <option value="">请选择植物类别</option>
                                <option value="乔木">乔木</option>
                                <option value="灌木">灌木</option>
                                <option value="草本">草本</option>
                                <option value="藤本">藤本</option>
                                <option value="蕨类">蕨类</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label for="plantFamily" class="block text-sm font-medium text-gray-700 mb-1">科</label>
                            <input type="text" id="plantFamily"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                   placeholder="请输入植物所属科">
                        </div>

                        <!-- 第三行 -->
                        <div class="mb-4">
                            <label for="plantGenus" class="block text-sm font-medium text-gray-700 mb-1">属</label>
                            <input type="text" id="plantGenus"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                   placeholder="请输入植物所属属">
                        </div>

                        <div class="mb-4">
                            <label for="plantEnvironment"
                                   class="block text-sm font-medium text-gray-700 mb-1">生长环境</label>
                            <input type="text" id="plantEnvironment"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                   placeholder="如：温带、亚热带地区">
                        </div>

                        <!-- 第四行 -->
                        <div class="mb-4">
                            <label for="plantLocation"
                                   class="block text-sm font-medium text-gray-700 mb-1">校园分布区域</label>
                            <input type="text" id="plantLocation"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                   placeholder="如：主干道两侧、图书馆前">
                        </div>

                        <div class="mb-4">
                            <label for="plantCollectionDate"
                                   class="block text-sm font-medium text-gray-700 mb-1">采集时间</label>
                            <input type="date" id="plantCollectionDate"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50">
                        </div>
                    </div>

                    <!-- 简介 - 单独一行 -->
                    <div class="mt-4">
                        <label for="plantDescription"
                               class="block text-sm font-medium text-gray-700 mb-1">植物简介</label>
                        <textarea id="plantDescription" rows="3"
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                  placeholder="简要描述植物的基本信息、历史背景等"></textarea>
                    </div>
                </div>

                <!-- 地图位置选择器 - 移动到表单底部 -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fa fa-map-marker"></i> 校园位置
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">在地图上标记位置</label>
                        <div class="map-selector mb-4" id="locationSelector">
                            <!-- 使用百度地图 -->
                            <div id="baidu-map-selector" style="width: 100%; height: 100%;"></div>
                        </div>
                        <div class="flex items-center">
                            <input type="text" id="plantLocationMap"
                                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                                   placeholder="位置描述，如：主干道两侧">
                            <button type="button" id="resetLocation"
                                    class="ml-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors">
                                重置位置
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 mt-6 pt-4 border-t border-gray-200">
                    <button type="button" id="cancelForm"
                            class="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors">取消
                    </button>
                    <button type="submit"
                            class="px-6 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors flex items-center">
                        <i class="fa fa-save mr-2"></i> 保存植物信息
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 二维码预览模态框 -->
<div id="qrcode-preview" class="qrcode-preview">
    <div class="qrcode-preview-content">
        <button id="qrcode-preview-close" class="qrcode-preview-close">×</button>
        <h3 class="qrcode-preview-title" id="qrcode-title">微信二维码</h3>
        <p class="qrcode-preview-desc" id="qrcode-desc">扫描二维码关注我们的微信公众号</p>
        <img id="qrcode-preview-img" src="" alt="二维码" class="qrcode-preview-img">
        <div class="qrcode-preview-info">
            点击任意位置或按ESC键关闭预览
        </div>
    </div>
</div>

<!-- 页脚 -->
<footer class="bg-dark text-white pt-16 pb-8">
    <div class="container mx-auto px-4">
        <div class="grid md:grid-cols-3 gap-8 mb-12">
            <!-- 左侧部分 -->
            <div class="text-center md:text-left">
                <div class="flex items-center space-x-2 mb-6 justify-center md:justify-start">
                    <i class="fa fa-leaf text-2xl text-accent"></i>
                    <span class="text-xl font-bold">校园植被身份证</span>
                </div>
                <p class="text-gray-400 mb-6">记录校园植物，传播自然知识，共建绿色校园</p>
            </div>

            <!-- 中间部分 -->
            <div class="text-center">
                <h3 class="text-lg font-semibold mb-6">快速链接</h3>
                <ul class="space-y-3">
                    <li><a href="#home" class="text-gray-400 hover:text-white transition-colors">首页</a></li>
                    <li><a href="#plants" class="text-gray-400 hover:text-white transition-colors">植物图鉴</a></li>
                    <li><a href="#map" class="text-gray-400 hover:text-white transition-colors">植被地图</a></li>
                    <li><a href="#admin" class="text-gray-400 hover:text-white transition-colors admin-nav-link-footer" style="display: none;">植物管理</a></li>
                </ul>
            </div>

            <!-- 右侧部分 - 修改这里 -->
            <div class="text-center md:text-left md:ml-auto md:mr-8">
                <h3 class="text-lg font-semibold mb-6">联系我们</h3>
                <ul class="space-y-3">
                    <!-- 可点击的QQ图标 -->
                    <li class="flex items-start justify-center md:justify-start">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors qq-qrcode flex items-start">
                            <i class="fa fa-qq text-accent mt-1 mr-3"></i>
                        </a>
                    </li>
                    <!-- 可点击的微信图标 -->
                    <li class="flex items-start justify-center md:justify-start">
                        <a href="#"
                           class="text-gray-400 hover:text-white transition-colors wechat-qrcode flex items-start">
                            <i class="fa fa-weixin text-accent mt-1 mr-3"></i>
                        </a>
                    </li>
                    <li class="flex items-start justify-center md:justify-start">
                        <i class="fa fa-envelope text-accent mt-1 mr-3"></i>
                        <span class="text-gray-400">2785300881@qq.com</span>
                    </li>
                </ul>
            </div>
        </div>

        <div class="border-t border-gray-800 pt-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-500 text-sm mb-4 md:mb-0">© 2025 范紫莫保留所有权利.</p>
            </div>
        </div>
    </div>
</footer>

<!-- 回到顶部按钮 -->
<button id="backToTop"
        class="fixed bottom-6 right-6 bg-primary hover:bg-primary/90 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 invisible">
    <i class="fa fa-chevron-up"></i>
</button>

<!-- JavaScript -->
<script>
    // Supabase配置
    const SUPABASE_URL = 'https://twzpessassvmnnbrnegd.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnd2J6dHVpenhvd2lhY3B3em15Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzMzIyMDYsImV4cCI6MjA3OTkwODIwNn0.js6fUBJ9FGRMkVgp80Q-8D6hX-xXbr29rWKyJgOA9b4';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 在JavaScript部分修改用户头像点击事件
    document.getElementById('userAvatar').addEventListener('click', function() {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const currentUser = localStorage.getItem('currentUser');
        const userRole = localStorage.getItem('userRole');

        if (isLoggedIn === 'true' && currentUser) {
            showUserMenu(currentUser, userRole);
        } else {
            window.location.href = 'login.html';
        }
    });

    // 更新显示用户菜单函数
    function showUserMenu(username, role) {
        // 如果用户是admin，显示为超级管理员
        const displayRole = (username === 'admin' && role === 'admin') ? 'super-admin' : role;

        const menuHtml = `
<div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-xl p-6 max-w-sm w-full mx-4">
        <h3 class="text-lg font-semibold mb-4">用户信息</h3>
        <p class="mb-2">欢迎，${username}！</p>
        <p class="mb-4 text-sm text-gray-600">角色：${displayRole === 'super-admin' ? '超级管理员' : (displayRole === 'admin' ? '管理员' : '普通用户')}</p>
        <div class="flex flex-col gap-2">
            <button onclick="openProfilePage()" class="w-full bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors flex items-center justify-center">
                <i class="fa fa-user mr-2"></i> 个人信息
            </button>
            <div class="flex gap-2">
                <button onclick="logout()" class="flex-1 bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">
                    退出登录
                </button>
                <button onclick="closeUserMenu()" class="flex-1 bg-gray-300 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                    关闭
                </button>
            </div>
        </div>
    </div>
</div>
`;

        const menuDiv = document.createElement('div');
        menuDiv.innerHTML = menuHtml;
        menuDiv.id = 'userMenuModal';
        document.body.appendChild(menuDiv);
    }
    function openProfilePage() {
        closeUserMenu();
        window.location.href = 'my.html';
    }

    // 关闭用户菜单
    function closeUserMenu() {
        const menu = document.getElementById('userMenuModal');
        if (menu) {
            menu.remove();
        }
    }

    // 退出登录
    function logout() {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('currentUser');
        localStorage.removeItem('userRole');
        closeUserMenu();
        alert('已退出登录');
        location.reload();
    }

    // 全局植物数据存储 - 改为从Supabase获取
    let plantData = {};

    // 从Supabase获取植物数据
    async function fetchPlantsFromSupabase() {
        try {
            const { data: plants, error } = await supabase
                .from('plants')
                .select('*')
                .order('id', { ascending: true });

            if (error) throw error;

            // 转换为原有的数据结构
            const formattedData = {};
            plants.forEach(plant => {
                formattedData[plant.id] = {
                    name: plant.name,
                    scientific: plant.scientific_name,
                    family: plant.family,
                    genus: plant.genus,
                    distribution: plant.distribution,
                    environment: plant.environment,
                    description: plant.description,
                    images: plant.images || ['img/default.png'],
                    collectionDate: plant.collection_date,
                    category: plant.category,
                    location: plant.location,
                    mapPosition: plant.map_position ? {
                        lng: plant.map_position.lng,
                        lat: plant.map_position.lat
                    } : { lng: 119.053194, lat: 33.558272 },
                    createdBy: plant.created_by
                };
            });

            return formattedData;
        } catch (error) {
            console.error('获取植物数据失败:', error);
            return {};
        }
    }

    // 保存植物到Supabase
    async function savePlantToSupabase(plant, isEdit = false, plantId = null) {
        try {
            const plantData = {
                name: plant.name,
                scientific_name: plant.scientific,
                category: plant.category,
                family: plant.family,
                genus: plant.genus,
                distribution: plant.distribution,
                environment: plant.environment,
                location: plant.location,
                description: plant.description,
                collection_date: plant.collectionDate,
                images: plant.images,
                map_position: plant.mapPosition,
                created_by: plant.createdBy,
                updated_at: new Date().toISOString()
            };

            let result;
            if (isEdit && plantId) {
                // 更新现有植物
                const { data, error } = await supabase
                    .from('plants')
                    .update(plantData)
                    .eq('id', plantId)
                    .select();

                if (error) throw error;
                result = data[0];
            } else {
                // 创建新植物
                plantData.created_at = new Date().toISOString();
                const { data, error } = await supabase
                    .from('plants')
                    .insert([plantData])
                    .select();

                if (error) throw error;
                result = data[0];
            }

            return result;
        } catch (error) {
            console.error('保存植物数据失败:', error);
            throw error;
        }
    }

    // 从Supabase删除植物
    async function deletePlantFromSupabase(plantId) {
        try {
            const { error } = await supabase
                .from('plants')
                .delete()
                .eq('id', plantId);

            if (error) throw error;
            return true;
        } catch (error) {
            console.error('删除植物失败:', error);
            throw error;
        }
    }

    // 轮播图配置
    const carouselConfig = {
        interval: 5000,
        currentSlide: 0
    };

    let carouselInterval = null;

    // 初始化轮播图
    function initCarousel() {
        const carouselContainer = document.querySelector('.carousel-container');
        const indicatorsContainer = document.getElementById('carousel-indicators');

        // 清空现有内容
        if (carouselContainer) {
            carouselContainer.innerHTML = '';
        }
        if (indicatorsContainer) {
            indicatorsContainer.innerHTML = '';
        }

        // 使用现有的植物数据中的图片
        const plantImages = Object.values(plantData).flatMap(plant => plant.images);

        // 如果植物图片不足，添加默认图片
        const images = plantImages.length > 0 ? plantImages : ['img/垂柳.jpg', 'img/海棠.jpg', 'img/月季.jpg'];

        // 创建轮播图片
        images.forEach((src, index) => {
            // 处理网络图，替换为本地默认图
            if (src && (src.startsWith('http://') || src.startsWith('https://'))) {
                src = 'img/垂柳.jpg';
            }

            if (carouselContainer) {
                const slide = document.createElement('div');
                slide.className = `carousel-slide ${index === 0 ? 'active' : ''}`;
                slide.innerHTML = `<img src="${src}" alt="植物图片 ${index + 1}" class="w-full h-full object-cover">`;
                carouselContainer.appendChild(slide);
            }

            // 创建指示器
            if (indicatorsContainer) {
                const indicator = document.createElement('div');
                indicator.className = `carousel-indicator ${index === 0 ? 'active' : ''}`;
                indicator.addEventListener('click', () => goToSlide(index));
                indicatorsContainer.appendChild(indicator);
            }
        });

        // 启动轮播
        startCarousel();
    }

    // 开始轮播
    function startCarousel() {
        // 清除现有计时器
        if (carouselInterval) {
            clearInterval(carouselInterval);
        }

        // 设置新计时器
        carouselInterval = setInterval(() => {
            const slides = document.querySelectorAll('.carousel-slide');
            if (slides.length > 0) {
                const nextSlide = (carouselConfig.currentSlide + 1) % slides.length;
                goToSlide(nextSlide);
            }
        }, carouselConfig.interval);
    }

    // 切换到指定幻灯片
    function goToSlide(index) {
        const slides = document.querySelectorAll('.carousel-slide');
        const indicators = document.querySelectorAll('.carousel-indicator');

        if (slides.length === 0 || indicators.length === 0) return;

        // 隐藏当前幻灯片，显示目标幻灯片
        slides[carouselConfig.currentSlide].classList.remove('active');
        indicators[carouselConfig.currentSlide].classList.remove('active');

        // 更新当前索引
        carouselConfig.currentSlide = index;

        // 显示目标幻灯片
        slides[carouselConfig.currentSlide].classList.add('active');
        indicators[carouselConfig.currentSlide].classList.add('active');
    }

    // 更新轮播图数据
    function updateCarousel() {
        // 重置当前幻灯片索引
        carouselConfig.currentSlide = 0;
        // 重新初始化轮播图
        initCarousel();
    }

    // 百度地图相关变量
    let map = null;
    let selectorMap = null;
    let currentMiniMap = null;
    let markers = [];
    let currentMarker = null;
    let hoverInfoWindow = null;
    let selectedPoint = null;

    // 分页相关变量
    let currentPage = 1;
    const itemsPerPage = 5;
    let plantsDisplayLimit = 6;
    let currentPreviewOption = 'original';

    // 详情图片放大预览功能
    const detailImagePreview = document.getElementById('detail-image-preview');
    const detailImagePreviewImg = document.getElementById('detail-image-preview-img');
    const detailImagePreviewClose = document.getElementById('detail-image-preview-close');
    const detailImageContainer = document.getElementById('detail-image-container');
    const detailImage = document.getElementById('detail-image');

    // 二维码预览功能
    const qrcodePreview = document.getElementById('qrcode-preview');
    const qrcodePreviewImg = document.getElementById('qrcode-preview-img');
    const qrcodePreviewClose = document.getElementById('qrcode-preview-close');
    const qrcodeTitle = document.getElementById('qrcode-title');
    const qrcodeDesc = document.getElementById('qrcode-desc');

    // 详情图片点击放大功能
    function setupDetailImagePreview() {
        // 点击图片容器或图片本身打开预览
        detailImageContainer.addEventListener('click', function (e) {
            e.stopPropagation();
            openDetailImagePreview();
        });

        detailImage.addEventListener('click', function (e) {
            e.stopPropagation();
            openDetailImagePreview();
        });

        // 关闭预览
        detailImagePreviewClose.addEventListener('click', closeDetailImagePreview);

        detailImagePreview.addEventListener('click', function (e) {
            if (e.target === this) {
                closeDetailImagePreview();
            }
        });

        // ESC键关闭预览
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && detailImagePreview.classList.contains('active')) {
                closeDetailImagePreview();
            }
        });
    }

    function openDetailImagePreview(imageSrc) {
        if (imageSrc) {
            detailImagePreviewImg.src = imageSrc;
            detailImagePreview.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
    }

    function closeDetailImagePreview() {
        detailImagePreview.classList.remove('active');
        document.body.style.overflow = '';
    }

    // 二维码预览功能
    function setupQrcodePreview() {
        // 微信二维码点击事件
        document.querySelector('.wechat-qrcode').addEventListener('click', function (e) {
            e.preventDefault();
            openQrcodePreview('微信二维码', '扫描二维码联系我们微信', 'img/wx.jpg');
        });

        // QQ二维码点击事件
        document.querySelector('.qq-qrcode').addEventListener('click', function (e) {
            e.preventDefault();
            openQrcodePreview('QQ二维码', '扫描二维码联系我们的QQ', 'img/qq.jpg');
        });

        // 关闭预览
        qrcodePreviewClose.addEventListener('click', closeQrcodePreview);

        qrcodePreview.addEventListener('click', function (e) {
            if (e.target === this) {
                closeQrcodePreview();
            }
        });

        // ESC键关闭预览
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && qrcodePreview.classList.contains('active')) {
                closeQrcodePreview();
            }
        });
    }

    function openQrcodePreview(title, desc, imageSrc) {
        qrcodeTitle.textContent = title;
        qrcodeDesc.textContent = desc;
        qrcodePreviewImg.src = imageSrc;
        qrcodePreview.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeQrcodePreview() {
        qrcodePreview.classList.remove('active');
        document.body.style.overflow = '';
    }

    // 导航栏滚动效果
    const navbar = document.getElementById('navbar');
    const backToTop = document.getElementById('backToTop');

    // 导航栏滚动效果 - 修改这部分代码
    window.addEventListener('scroll', function () {
        if (window.scrollY > 100) {
            navbar.classList.add('bg-white', 'shadow-md');
            navbar.classList.remove('bg-transparent');

            // 修改"校园植被身份证"文字颜色 - 和导航链接保持一致
            document.querySelector('#navbar span').classList.remove('text-white');
            document.querySelector('#navbar span').classList.add('text-dark');

            // 修改搜索按钮颜色 - 和导航链接保持一致
            document.querySelector('#searchBtn').classList.remove('text-white');
            document.querySelector('#searchBtn').classList.add('text-dark');

            // 保持原有的其他元素颜色修改
            document.querySelectorAll('#navbar a').forEach(link => {
                link.classList.remove('text-white');
                link.classList.add('text-dark');
            });

            document.querySelector('#menuBtn').classList.remove('text-white');
            document.querySelector('#menuBtn').classList.add('text-dark');

            backToTop.classList.remove('opacity-0', 'invisible');
            backToTop.classList.add('opacity-100', 'visible');
        } else {
            navbar.classList.remove('bg-white', 'shadow-md');
            navbar.classList.add('bg-transparent');

            // 修改"校园植被身份证"文字颜色 - 和导航链接保持一致
            document.querySelector('#navbar span').classList.remove('text-dark');
            document.querySelector('#navbar span').classList.add('text-white');

            // 修改搜索按钮颜色 - 和导航链接保持一致
            document.querySelector('#searchBtn').classList.remove('text-dark');
            document.querySelector('#searchBtn').classList.add('text-white');

            // 保持原有的其他元素颜色修改
            document.querySelectorAll('#navbar a').forEach(link => {
                link.classList.remove('text-dark');
                link.classList.add('text-white');
            });

            document.querySelector('#menuBtn').classList.remove('text-dark');
            document.querySelector('#menuBtn').classList.add('text-white');

            backToTop.classList.add('opacity-0', 'invisible');
            backToTop.classList.remove('opacity-100', 'visible');
        }
    });

    // 移动端菜单
    const menuBtn = document.getElementById('menuBtn');
    const mobileMenu = document.getElementById('mobileMenu');

    menuBtn.addEventListener('click', function () {
        if (mobileMenu.classList.contains('opacity-0')) {
            mobileMenu.classList.remove('opacity-0', '-translate-y-full', 'pointer-events-none');
            mobileMenu.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
            menuBtn.innerHTML = '<i class="fa fa-times"></i>';
        } else {
            mobileMenu.classList.add('opacity-0', '-translate-y-full', 'pointer-events-none');
            mobileMenu.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
            menuBtn.innerHTML = '<i class="fa fa-bars"></i>';
        }
    });

    // 搜索模态框
    const searchBtn = document.getElementById('searchBtn');
    const searchModal = document.getElementById('searchModal');
    const closeSearch = document.getElementById('closeSearch');
    const modalSearchInput = document.getElementById('modalSearchInput');
    const mobileSearchInput = document.getElementById('mobileSearchInput');
    const plantSearchInput = document.getElementById('plantSearchInput');
    const searchTags = document.querySelectorAll('.search-tag');

    searchBtn.addEventListener('click', function () {
        searchModal.classList.remove('opacity-0', 'pointer-events-none');
        modalSearchInput.focus();
        document.body.style.overflow = 'hidden';
    });

    closeSearch.addEventListener('click', function () {
        searchModal.classList.add('opacity-0', 'pointer-events-none');
        document.body.style.overflow = 'auto';
    });

    // 搜索标签点击事件
    searchTags.forEach(tag => {
        tag.addEventListener('click', function () {
            const searchText = this.textContent;
            modalSearchInput.value = searchText;
            filterPlants(searchText, currentFilter);
        });
    });

    // 植物分类筛选和搜索的全局变量
    let currentFilter = 'all';
    let currentSearch = '';

    // 搜索输入框事件
    function setupSearchInput(inputElement) {
        inputElement.addEventListener('input', function () {
            currentSearch = this.value.toLowerCase().trim();
            filterPlants(currentSearch, currentFilter);

            if (inputElement === modalSearchInput) {
                searchModal.classList.add('opacity-0', 'pointer-events-none');
                document.body.style.overflow = 'auto';
                document.getElementById('plants').scrollIntoView({behavior: 'smooth'});
            }

            if (inputElement === mobileSearchInput && !mobileMenu.classList.contains('opacity-0')) {
                menuBtn.click();
            }
        });
    }

    setupSearchInput(modalSearchInput);
    setupSearchInput(mobileSearchInput);
    setupSearchInput(plantSearchInput);

    // 植物分类筛选
    const filterButtons = document.querySelectorAll('.filter-btn');

    filterButtons.forEach(button => {
        button.addEventListener('click', function () {
            filterButtons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-white', 'text-gray-700', 'border', 'border-gray-300');
            });

            this.classList.remove('bg-white', 'text-gray-700', 'border', 'border-gray-300');
            this.classList.add('bg-primary', 'text-white');

            currentFilter = this.getAttribute('data-filter');
            filterPlants(currentSearch, currentFilter);
        });
    });

    // 植物筛选函数
    function filterPlants(searchText, filter) {
        const plantCards = document.querySelectorAll('.plant-card');
        let hasResults = false;
        let counts = {
            total: 0,
            乔木: 0,
            灌木: 0,
            草本: 0,
            藤本: 0,
            蕨类: 0
        };

        plantCards.forEach(card => {
            const name = card.getAttribute('data-name').toLowerCase();
            const family = card.getAttribute('data-family').toLowerCase();
            const type = card.getAttribute('data-type');
            const scientific = card.getAttribute('data-scientific').toLowerCase();
            const description = card.querySelector('.plant-description').textContent.toLowerCase();

            const matchesSearch = searchText === '' ||
                name.includes(searchText) ||
                family.includes(searchText) ||
                type.includes(searchText) ||
                scientific.includes(searchText) ||
                description.includes(searchText);

            const matchesFilter = filter === 'all' || type === filter;

            if (matchesSearch && matchesFilter) {
                card.style.display = 'block';
                hasResults = true;
                counts.total++;
                counts[type]++;
            } else {
                card.style.display = 'none';
            }
        });

        updatePlantStatistics(counts);
        document.getElementById('noResults').style.display = hasResults ? 'none' : 'flex';
    }

    // 更新植物统计数据和图表
    let plantChart = null;

    function updatePlantStatistics(counts) {
        document.getElementById('total-plants-count').textContent = counts.total;
        document.getElementById('total-plants-display').textContent = counts.total;
        document.getElementById('trees-count').textContent = counts.乔木;
        document.getElementById('shrubs-count').textContent = counts.灌木;
        document.getElementById('herbs-count').textContent = counts.草本;
        document.getElementById('vines-count').textContent = counts.藤本 + counts.蕨类;

        if (!plantChart) {
            const ctx = document.getElementById('plantChart').getContext('2d');
            plantChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['乔木', '灌木', '草本', '藤本', '蕨类'],
                    datasets: [{
                        data: [counts.乔木, counts.灌木, counts.草本, counts.藤本, counts.蕨类],
                        backgroundColor: [
                            '#2E7D32',
                            '#4CAF50',
                            '#8BC34A',
                            '#CDDC39',
                            '#FFC107'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    cutout: '70%'
                }
            });
        } else {
            plantChart.data.datasets[0].data = [
                counts.乔木,
                counts.灌木,
                counts.草本,
                counts.藤本,
                counts.蕨类
            ];
            plantChart.update();
        }
    }

    // 显示植物详情 - 修改为支持多张图片
    function showPlantDetails(plantId) {
        const plant = plantData[plantId];

        document.getElementById('detail-title').textContent = plant.name;
        document.getElementById('detail-subtitle').textContent = plant.scientific;
        document.getElementById('info-family').textContent = plant.family;
        document.getElementById('info-genus').textContent = plant.genus;
        document.getElementById('info-distribution').textContent = plant.distribution;
        document.getElementById('info-environment').textContent = plant.environment;
        document.getElementById('info-collection-date').textContent = plant.collectionDate;

        // 设置主图片（第一张图片）
        const mainImage = plant.images && plant.images.length > 0 ? plant.images[0] : 'img/default.png';
        document.getElementById('detail-image').src = mainImage;
        document.getElementById('detail-image').alt = plant.name;

        document.getElementById('info-description').textContent = plant.description;

        // 更新更多照片区域
        updateMorePhotosSection(plant);

        // 显示详情页面
        document.getElementById('specimen-detail').classList.add('active');
        document.body.style.overflow = 'hidden';

        updateMiniMap(plant);
    }

    // 新增：更新更多照片区域
    function updateMorePhotosSection(plant) {
        const morePhotosSection = document.getElementById('more-photos-section');
        const morePhotosGrid = document.getElementById('more-photos-grid');

        // 清空现有内容
        morePhotosGrid.innerHTML = '';

        // 检查是否有额外的照片（除了第一张之外的照片）
        if (plant.images && plant.images.length > 1) {
            // 显示更多照片区域
            morePhotosSection.style.display = 'block';

            // 添加除第一张外的所有照片
            for (let i = 1; i < plant.images.length; i++) {
                const photoItem = document.createElement('div');
                photoItem.className = 'more-photo-item';

                const img = document.createElement('img');
                img.src = plant.images[i];
                img.alt = `${plant.name} - 照片 ${i + 1}`;
                img.className = 'more-photo-img';

                // 点击照片可以放大查看
                img.addEventListener('click', function () {
                    openDetailImagePreview(plant.images[i]);
                });

                photoItem.appendChild(img);
                morePhotosGrid.appendChild(photoItem);
            }
        } else {
            // 隐藏更多照片区域
            morePhotosSection.style.display = 'none';
        }
    }

    // 更新详情页小地图
    function updateMiniMap(plant) {
        // 清理之前的小地图
        if (currentMiniMap) {
            try {
                currentMiniMap.destroy();
                currentMiniMap = null;
            } catch (e) {
                console.warn("清理小地图时出现警告:", e);
            }
        }

        const miniMapContainer = document.getElementById("mini-map");
        if (!miniMapContainer) return;

        // 完全重新创建容器
        miniMapContainer.innerHTML = '';

        // 创建新的地图容器，使用唯一ID
        const mapId = `mini-map-${Date.now()}`;
        const mapDiv = document.createElement('div');
        mapDiv.id = mapId;
        mapDiv.style.width = '100%';
        mapDiv.style.height = '100%';
        miniMapContainer.appendChild(mapDiv);

        // 延迟初始化确保DOM已更新
        setTimeout(() => {
            try {
                // 创建全新的地图实例
                currentMiniMap = new BMap.Map(mapId);
                const point = new BMap.Point(plant.mapPosition.lng, plant.mapPosition.lat);
                currentMiniMap.centerAndZoom(point, 17);

                // 禁用所有交互
                currentMiniMap.disableScrollWheelZoom();
                currentMiniMap.disableDoubleClickZoom();
                currentMiniMap.enableInertialDragging(false);
                currentMiniMap.enableContinuousZoom(false);
                currentMiniMap.disableDragging();

                // 添加基本控件
                currentMiniMap.addControl(new BMap.NavigationControl({
                    type: BMAP_NAVIGATION_CONTROL_SMALL,
                    anchor: BMAP_ANCHOR_TOP_LEFT
                }));

                // 添加标记
                const marker = new BMap.Marker(point);
                currentMiniMap.addOverlay(marker);

                // 信息窗口
                const infoWindow = new BMap.InfoWindow(`
                    <div style="padding:10px;max-width:200px;">
                        <h4 style="margin:0 0 5px 0;color:#2E7D32;">${plant.name}</h4>
                        <p style="margin:0;font-size:12px;color:#666;">位置: ${plant.location}</p>
                        <p style="margin:0;font-size:12px;color:#666;">类别: ${plant.category}</p>
                    </div>
                `);

                marker.addEventListener("click", function () {
                    currentMiniMap.openInfoWindow(infoWindow, point);
                });

                // 强制刷新地图尺寸
                setTimeout(() => {
                    currentMiniMap.checkResize();
                }, 50);

            } catch (error) {
                console.error("小地图初始化失败:", error);
            }
        }, 100);
    }

    // 关闭详情页面
    function closeDetailPanel() {
        document.getElementById('specimen-detail').classList.remove('active');
        document.body.style.overflow = 'auto';

        // 清理小地图资源
        if (currentMiniMap) {
            try {
                currentMiniMap.destroy();
                currentMiniMap = null;
            } catch (e) {
                console.warn("清理小地图时出现警告:", e);
            }
        }
    }

    // 事件监听
    document.getElementById('close-detail').addEventListener('click', closeDetailPanel);

    // 点击详情页面外部关闭
    document.getElementById('specimen-detail').addEventListener('click', function (e) {
        if (e.target === this) {
            closeDetailPanel();
        }
    });

    // 回到顶部
    backToTop.addEventListener('click', function () {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // 平滑滚动
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();

            if (!mobileMenu.classList.contains('opacity-0')) {
                menuBtn.click();
            }

            const targetId = this.getAttribute('href');
            if (targetId === '#') return;

            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({behavior: 'smooth'});
            }
        });
    });

    // 图片预览功能
    function openImagePreview(src) {
        const fullscreenImage = document.getElementById('fullscreen-image');
        const previewModal = document.getElementById('image-preview-modal');

        fullscreenImage.src = src;

        if (currentPreviewOption === 'rotate') {
            fullscreenImage.classList.add('rotated-image');
        } else {
            fullscreenImage.classList.remove('rotated-image');
        }

        previewModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';

        setTimeout(() => {
            fullscreenImage.classList.add('opacity-100');
        }, 10);
    }

    // 关闭图片全屏预览
    function closeImagePreview() {
        const previewModal = document.getElementById('image-preview-modal');
        const fullscreenImage = document.getElementById('fullscreen-image');

        fullscreenImage.classList.remove('opacity-100');
        previewModal.classList.add('hidden');
        document.body.style.overflow = '';
    }

    // 关闭图片预览
    document.getElementById('close-image-preview').addEventListener('click', closeImagePreview);

    // 图片预览模态框点击关闭
    document.getElementById('image-preview-modal').addEventListener('click', function (e) {
        if (e.target === this) {
            closeImagePreview();
        }
    });

    // ESC键关闭图片预览
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && !document.getElementById('image-preview-modal').classList.contains('hidden')) {
            closeImagePreview();
        }
    });

    // 初始化百度地图
    function initBaiduMap() {
        // 检查地图容器是否存在
        const mapContainer = document.getElementById('baidu-map-container');
        if (!mapContainer) {
            console.error('地图容器未找到');
            return;
        }

        // 如果地图已经初始化，直接返回
        if (map) {
            console.log('地图已经初始化');
            return;
        }

        console.log('开始初始化百度地图...');

        // 创建地图实例
        map = new BMap.Map("baidu-map-container");

        // 设置中心点坐标
        const point = new BMap.Point(119.053194, 33.558272);

        // 初始化地图
        map.centerAndZoom(point, 17);

        // 启用滚轮缩放
        map.enableScrollWheelZoom(true);

        // 添加地图类型控件
        map.addControl(new BMap.MapTypeControl({
            mapTypes: [BMAP_NORMAL_MAP, BMAP_HYBRID_MAP]
        }));

        // 添加导航控件
        map.addControl(new BMap.NavigationControl({
            type: BMAP_NAVIGATION_CONTROL_ZOOM,
            anchor: BMAP_ANCHOR_TOP_LEFT
        }));

        // 添加比例尺控件
        map.addControl(new BMap.ScaleControl({
            anchor: BMAP_ANCHOR_BOTTOM_LEFT
        }));

        // 添加缩略图控件
        map.addControl(new BMap.OverviewMapControl({
            anchor: BMAP_ANCHOR_BOTTOM_RIGHT,
            isOpen: false
        }));

        // 地图加载完成事件
        map.addEventListener("tilesloaded", function () {
            console.log("地图加载完成，当前中心点:", map.getCenter().lng, map.getCenter().lat);
            // 地图加载完成后添加标记
            updateBaiduMapMarkers();
        });

        console.log("百度地图初始化完成");
    }

    // 更新百度地图标记
    function updateBaiduMapMarkers(filter = 'all') {
        if (!map) {
            console.error('地图未初始化，无法更新标记');
            return;
        }

        // 清除现有标记
        map.clearOverlays();
        markers = [];

        Object.keys(plantData).forEach(id => {
            const plant = plantData[id];

            if (filter !== 'all' && plant.category !== filter) {
                return;
            }

            const point = new BMap.Point(plant.mapPosition.lng, plant.mapPosition.lat);
            const marker = createCustomMarker(point, plant.category);
            map.addOverlay(marker);

            const infoWindow = new BMap.InfoWindow(`
            <div class="baidu-info-window">
                <div class="baidu-info-window-content">
                    <div class="baidu-info-window-text">
                        <h3>${plant.name}</h3>
                        <p><strong>位置:</strong> ${plant.location}</p>
                        <p><strong>类别:</strong> ${plant.category}</p>
                        <button onclick="showPlantDetails(${id})">查看详情</button>
                    </div>
                    <img src="${plant.images[0]}" alt="${plant.name}" class="baidu-info-window-image">
                </div>
            </div>
        `, {
                width: 280,
                height: 130,
                offset: new BMap.Size(0, -30)
            });

            marker.addEventListener("click", function () {
                map.closeInfoWindow();
                map.openInfoWindow(infoWindow, point);
            });

            let hoverTimer = null;
            let hideTimer = null;

            marker.addEventListener("mouseover", function () {
                if (hideTimer) {
                    clearTimeout(hideTimer);
                    hideTimer = null;
                }

                hoverTimer = setTimeout(() => {
                    map.closeInfoWindow();
                    map.openInfoWindow(infoWindow, point);
                    hoverInfoWindow = infoWindow;
                    hoverTimer = null;
                }, 100);
            });

            marker.addEventListener("mouseout", function () {
                if (hoverTimer) {
                    clearTimeout(hoverTimer);
                    hoverTimer = null;
                }

                hideTimer = setTimeout(() => {
                    if (hoverInfoWindow === infoWindow) {
                        map.closeInfoWindow();
                        hoverInfoWindow = null;
                    }
                    hideTimer = null;
                }, 2000);
            });

            marker.addEventListener("mousemove", function () {
                if (hideTimer) {
                    clearTimeout(hideTimer);
                    hideTimer = null;
                }
            });

            markers.push(marker);
        });
    }

    // 创建自定义标记
    function createCustomMarker(point, category) {
        const marker = new BMap.Marker(point, {});

        let markerClass = 'baidu-marker-tree';
        let iconClass = 'fa-tree';

        switch (category) {
            case '灌木':
                markerClass = 'baidu-marker-shrub';
                iconClass = 'fa-pagelines';
                break;
            case '草本':
                markerClass = 'baidu-marker-herb';
                iconClass = 'fa-leaf';
                break;
            case '藤本':
                markerClass = 'baidu-marker-vine';
                iconClass = 'fa-vine';
                break;
            case '蕨类':
                markerClass = 'baidu-marker-fern';
                iconClass = 'fa-pagelines';
                break;
        }

        marker.setLabel(new BMap.Label(`<div class="baidu-marker ${markerClass}"><i class="fa ${iconClass}"></i></div>`, {
            offset: new BMap.Size(-12, -12)
        }));

        return marker;
    }

    // 地图植物筛选按钮
    const mapFilterButtons = document.querySelectorAll('.filter-map-btn');

    mapFilterButtons.forEach(button => {
        button.addEventListener('click', function () {
            mapFilterButtons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-100', 'hover:bg-gray-200');
            });

            this.classList.remove('bg-gray-100', 'hover:bg-gray-200');
            this.classList.add('bg-primary', 'text-white');

            const filter = this.getAttribute('data-filter');
            updateBaiduMapMarkers(filter);

            const legendItems = document.querySelectorAll('#map-legend > div');
            legendItems.forEach(item => {
                const typeText = item.querySelector('span').textContent;
                const iconDiv = item.querySelector('div');

                iconDiv.className = 'w-4 h-4 rounded-full mr-2';

                if (filter === 'all') {
                    switch (typeText) {
                        case '乔木':
                            iconDiv.classList.add('bg-primary');
                            break;
                        case '灌木':
                            iconDiv.classList.add('bg-secondary');
                            break;
                        case '草本':
                            iconDiv.classList.add('bg-accent');
                            break;
                        case '藤本':
                            iconDiv.classList.add('bg-yellow-500');
                            break;
                        case '蕨类':
                            iconDiv.classList.add('bg-purple-500');
                            break;
                    }
                } else {
                    if (typeText === filter) {
                        switch (typeText) {
                            case '乔木':
                                iconDiv.classList.add('bg-primary', 'ring-2', 'ring-primary/50');
                                break;
                            case '灌木':
                                iconDiv.classList.add('bg-secondary', 'ring-2', 'ring-secondary/50');
                                break;
                            case '草本':
                                iconDiv.classList.add('bg-accent', 'ring-2', 'ring-accent/50');
                                break;
                            case '藤本':
                                iconDiv.classList.add('bg-yellow-500', 'ring-2', 'ring-yellow-500/50');
                                break;
                            case '蕨类':
                                iconDiv.classList.add('bg-purple-500', 'ring-2', 'ring-purple-500/50');
                                break;
                        }
                    } else {
                        switch (typeText) {
                            case '乔木':
                                iconDiv.classList.add('bg-primary');
                                break;
                            case '灌木':
                                iconDiv.classList.add('bg-secondary');
                                break;
                            case '草本':
                                iconDiv.classList.add('bg-accent');
                                break;
                            case '藤本':
                                iconDiv.classList.add('bg-yellow-500');
                                break;
                            case '蕨类':
                                iconDiv.classList.add('bg-purple-500');
                                break;
                        }
                    }
                }
            });
        });
    });

    // 从植物详情页跳转至地图对应位置
    document.querySelectorAll('.view-map-btn').forEach(btn => {
        btn.addEventListener('click', function () {
            closeDetailPanel();
            document.getElementById('map').scrollIntoView({behavior: 'smooth'});
            const location = this.getAttribute('data-location');
            console.log(`定位到：${location}`);
        });
    });

    // 植物管理功能
    const addPlantBtn = document.getElementById('addPlantBtn');
    const plantManagementModal = document.getElementById('plantManagementModal');
    const plantTableBody = document.getElementById('plantTableBody');
    const plantDataForm = document.getElementById('plantDataForm');
    const closeManagementModal = document.getElementById('closeManagementModal');
    const cancelForm = document.getElementById('cancelForm');
    const managementModalTitle = document.getElementById('managementModalTitle');
    const resetLocation = document.getElementById('resetLocation');
    const imageDropzone = document.getElementById('imageDropzone');
    const imageUpload = document.getElementById('imageUpload');
    const imagePreview = document.getElementById('imagePreview');
    const prevPageBtn = document.getElementById('prevPageBtn');
    const nextPageBtn = document.getElementById('nextPageBtn');
    const pageNumbersContainer = document.getElementById('pageNumbers');

    let currentEditingId = null;
    let uploadedImages = [];

    // 初始化选择器地图
    function initSelectorMap() {
        // 确保地图容器存在且可见
        const mapContainer = document.getElementById('baidu-map-selector');
        if (!mapContainer) {
            console.error('选择器地图容器未找到');
            return;
        }

        // 如果已有地图实例，先销毁
        if (selectorMap) {
            selectorMap.destroy();
            selectorMap = null;
        }

        // 创建地图实例
        selectorMap = new BMap.Map("baidu-map-selector");

        // 设置中心点坐标
        const point = new BMap.Point(119.053194, 33.558272);

        // 初始化地图
        selectorMap.centerAndZoom(point, 17);

        // 关键修复：禁用惯性拖拽和持续缩放
        selectorMap.enableInertialDragging(false);
        selectorMap.enableContinuousZoom(false);

        // 关键修改：禁用滚轮缩放
        selectorMap.disableScrollWheelZoom();

        // 设置缩放级别限制
        selectorMap.setMinZoom(15);
        selectorMap.setMaxZoom(19);

        // 禁用双击缩放
        selectorMap.disableDoubleClickZoom();

        // 添加地图类型控件
        selectorMap.addControl(new BMap.MapTypeControl({
            mapTypes: [BMAP_NORMAL_MAP, BMAP_HYBRID_MAP]
        }));

        // 添加导航控件
        selectorMap.addControl(new BMap.NavigationControl({
            type: BMAP_NAVIGATION_CONTROL_ZOOM,
            anchor: BMAP_ANCHOR_TOP_LEFT
        }));


        selectorMap.addEventListener("tilesloaded", function () {
            console.log("选择器地图加载完成");

            // 强制刷新地图尺寸
            setTimeout(() => {
                selectorMap.checkResize();
                console.log("地图尺寸刷新完成");

                // 如果有选中的点，重新设置标记
                if (selectedPoint) {
                    setLocationMarker(selectedPoint.lng, selectedPoint.lat);
                }
            }, 100);
        });


        selectorMap.addEventListener("zoomend", function () {
            console.log("地图缩放结束");
            // 缩放后重新设置标记以确保位置正确
            if (currentMarker && selectedPoint) {
                setTimeout(() => {
                    setLocationMarker(selectedPoint.lng, selectedPoint.lat);
                }, 50);
            }
        });

        selectorMap.addEventListener("dragend", function () {
            console.log("地图拖拽结束");
            // 拖拽后重新设置标记以确保位置正确
            if (currentMarker && selectedPoint) {
                setTimeout(() => {
                    setLocationMarker(selectedPoint.lng, selectedPoint.lat);
                }, 50);
            }
        });

        // 添加点击事件
        selectorMap.addEventListener("click", function (e) {

            const lng = e.point.lng;
            const lat = e.point.lat;

            console.log("点击位置坐标:", lng, lat);
            setLocationMarker(lng, lat);

            // 保存选中的坐标点
            selectedPoint = {lng: lng, lat: lat};
        });

        console.log("选择器地图初始化完成");
    }

    // 设置位置标记
    function setLocationMarker(lng, lat) {
        console.log("设置标记位置:", lng, lat);

        // 清除现有标记
        if (currentMarker) {
            selectorMap.removeOverlay(currentMarker);
            currentMarker = null;
        }

        // 创建新标记
        const point = new BMap.Point(lng, lat);
        currentMarker = new BMap.Marker(point);


        currentMarker.disableDragging();

        selectorMap.addOverlay(currentMarker);


        // 更新位置描述
        document.getElementById('plantLocationMap').value = `经度: ${lng.toFixed(6)}, 纬度: ${lat.toFixed(6)}`;

        console.log("标记设置完成，当前位置:", selectorMap.getCenter().lng, selectorMap.getCenter().lat);
    }

    // 重置位置标记
    function resetLocationMarker() {
        if (currentMarker) {
            selectorMap.removeOverlay(currentMarker);
            currentMarker = null;
        }
        selectedPoint = null;
        document.getElementById('plantLocationMap').value = '';

        // 重置地图视图到初始中心
        const point = new BMap.Point(119.053194, 33.558272);
        selectorMap.panTo(point);
    }

    // 获取位置标记坐标
    function getLocationMarkerPosition() {
        if (currentMarker && selectedPoint) {

            return selectedPoint;
        }
        return null;
    }

    // 添加植物
    addPlantBtn.addEventListener('click', function () {
        currentEditingId = null;
        managementModalTitle.textContent = '添加新植被';
        plantManagementModal.classList.remove('opacity-0', 'pointer-events-none');
        plantManagementModal.querySelector('div').classList.remove('scale-95');
        plantManagementModal.querySelector('div').classList.add('scale-100');
        document.body.style.overflow = 'hidden';


        resetForm();


        setTimeout(() => {
            initSelectorMap();
        }, 300);
    });

    // 编辑植物
    function editPlant(id) {
        currentEditingId = id;
        managementModalTitle.textContent = '编辑植物信息';
        plantManagementModal.classList.remove('opacity-0', 'pointer-events-none');
        plantManagementModal.querySelector('div').classList.remove('scale-95');
        plantManagementModal.querySelector('div').classList.add('scale-100');
        document.body.style.overflow = 'hidden';

        const plant = plantData[id];

        // 填充表单数据
        document.getElementById('plantName').value = plant.name;
        document.getElementById('plantScientific').value = plant.scientific;
        document.getElementById('plantCategory').value = plant.category;
        document.getElementById('plantFamily').value = plant.family;
        document.getElementById('plantGenus').value = plant.genus;
        document.getElementById('plantEnvironment').value = plant.environment;
        document.getElementById('plantLocation').value = plant.location;
        document.getElementById('plantDescription').value = plant.description;
        document.getElementById('plantCollectionDate').value = plant.collectionDate;

        // 设置选中的点
        if (plant.mapPosition) {
            selectedPoint = plant.mapPosition;
        }

        // 设置图片预览
        uploadedImages = plant.images || []; // 修改为数组形式
        updateImagePreview();


        setTimeout(() => {
            initSelectorMap();

            // 设置位置标记
            if (plant.mapPosition) {
                // 等待地图完全加载后再设置标记
                setTimeout(() => {
                    setLocationMarker(plant.mapPosition.lng, plant.mapPosition.lat);
                }, 500);
            } else {
                resetLocationMarker();
            }
        }, 300);
    }

    // 删除植物
    function deletePlant(id) {
        const currentUser = localStorage.getItem('currentUser');
        const userRole = localStorage.getItem('userRole');
        const plant = plantData[id];

        // 权限检查：管理员可以删除所有植物，普通用户只能删除自己创建的植物
        if (userRole !== 'admin' && plant.createdBy !== currentUser) {
            alert('您没有权限删除此植物！');
            return;
        }

        if (confirm('确定要删除这个植物吗？此操作不可恢复。')) {
            const plantName = plant.name;
            delete plantData[id];

            // 显示删除成功提示
            showSuccessMessage(`植物 "${plantName}" 已成功删除！`);

            initPlantTable();
            updatePlantsGrid();
            updateBaiduMapMarkers();
            updatePlantStatistics(calculatePlantCounts());
            updateCarousel();
            updateTopLocations();
            updateSeasonalPlants();
        }
    }

    // 重置表单
    function resetForm() {
        // 重置所有表单字段
        document.getElementById('plantName').value = '';
        document.getElementById('plantScientific').value = '';
        document.getElementById('plantCategory').value = '';
        document.getElementById('plantFamily').value = '';
        document.getElementById('plantGenus').value = '';
        document.getElementById('plantEnvironment').value = '';
        document.getElementById('plantLocation').value = '';
        document.getElementById('plantDescription').value = '';
        document.getElementById('plantCollectionDate').value = '';

        // 重置地图位置
        resetLocationMarker();

        // 重置图片上传
        uploadedImages = [];
        updateImagePreview();

        // 重置文件输入
        document.getElementById('imageUpload').value = '';

        // 重置当前编辑ID
        currentEditingId = null;
    }

    // 关闭管理模态框
    closeManagementModal.addEventListener('click', function () {
        plantManagementModal.classList.add('opacity-0', 'pointer-events-none');
        plantManagementModal.querySelector('div').classList.remove('scale-100');
        plantManagementModal.querySelector('div').classList.add('scale-95');
        document.body.style.overflow = 'auto';

        // 清理地图资源
        if (selectorMap) {
            selectorMap.destroy();
            selectorMap = null;
        }
        // 重置选中的点
        selectedPoint = null;
        resetForm();
    });

    // 取消表单
    cancelForm.addEventListener('click', function () {
        closeManagementModal.click();
    });

    // 重置位置按钮事件
    resetLocation.addEventListener('click', resetLocationMarker);

    // 表单提交
    plantDataForm.addEventListener('submit', function (e) {
        e.preventDefault();

        if (!validateForm()) {
            return;
        }

        const currentUser = localStorage.getItem('currentUser');

        const plant = {
            name: document.getElementById('plantName').value,
            scientific: document.getElementById('plantScientific').value,
            category: document.getElementById('plantCategory').value,
            family: document.getElementById('plantFamily').value,
            genus: document.getElementById('plantGenus').value,
            distribution: document.getElementById('plantLocation').value,
            environment: document.getElementById('plantEnvironment').value,
            location: document.getElementById('plantLocation').value,
            description: document.getElementById('plantDescription').value,
            collectionDate: document.getElementById('plantCollectionDate').value,
            images: uploadedImages.length > 0 ? uploadedImages : ['img/default.png'],
            mapPosition: getLocationMarkerPosition(),
            createdBy: currentUser // 记录创建者
        };

        // 显示加载状态
        const submitBtn = plantDataForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> 保存中...';
        submitBtn.disabled = true;

        // 模拟保存过程
        setTimeout(() => {
            let successMessage = '';

            if (currentEditingId) {
                // 编辑时保留原有的创建者信息
                if (plantData[currentEditingId] && plantData[currentEditingId].createdBy) {
                    plant.createdBy = plantData[currentEditingId].createdBy;
                }
                plantData[currentEditingId] = plant;
                successMessage = `植物 "${plant.name}" 已成功更新！`;
            } else {
                const newId = Math.max(...Object.keys(plantData).map(Number)) + 1;
                plantData[newId] = plant;
                successMessage = `植物 "${plant.name}" 已成功添加！`;
            }

            // 恢复按钮状态
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;

            // 显示成功提示
            showSuccessMessage(successMessage);

            // 更新界面
            initPlantTable();
            updatePlantsGrid();
            updateBaiduMapMarkers();
            updatePlantStatistics(calculatePlantCounts());
            updateCarousel();
            updateTopLocations();
            updateSeasonalPlants();

            // 2秒后自动关闭模态框
            setTimeout(() => {
                closeManagementModal.click();
            }, 2000);

        }, 800);
    });
    // 表单验证
    function validateForm() {
        const plantName = document.getElementById('plantName').value.trim();
        const plantCategory = document.getElementById('plantCategory').value;

        // 检查名称是否为空
        if (!plantName) {
            alert('请填写植物名称');
            document.getElementById('plantName').focus();
            return false;
        }

        // 检查类别是否为空
        if (!plantCategory) {
            alert('请选择植物类别');
            document.getElementById('plantCategory').focus();
            return false;
        }

        // 检查名称是否唯一
        const isNameUnique = checkPlantNameUnique(plantName, currentEditingId);
        if (!isNameUnique) {
            alert('植物名称已存在，请使用其他名称');
            document.getElementById('plantName').focus();
            return false;
        }

        return true;
    }

    // 检查植物名称是否唯一
    function checkPlantNameUnique(name, editingId) {
        for (const id in plantData) {
            // 如果是编辑模式，跳过当前编辑的植物
            if (editingId && id === editingId.toString()) {
                continue;
            }
            if (plantData[id].name === name) {
                return false;
            }
        }
        return true;
    }
    // 添加成功提示函数
    function showSuccessMessage(message) {
        // 创建成功提示元素
        const successDiv = document.createElement('div');
        successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
        successDiv.innerHTML = `
        <div class="flex items-center">
            <i class="fa fa-check-circle mr-2"></i>
            <span>${message}</span>
        </div>
    `;

        document.body.appendChild(successDiv);

        // 显示动画
        setTimeout(() => {
            successDiv.classList.remove('translate-x-full');
        }, 100);

        // 自动隐藏
        setTimeout(() => {
            successDiv.classList.add('translate-x-full');
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.parentNode.removeChild(successDiv);
                }
            }, 300);
        }, 2000);
    }

    // 图片上传功能
    imageDropzone.addEventListener('click', function () {
        imageUpload.click();
    });

    imageDropzone.addEventListener('dragover', function (e) {
        e.preventDefault();
        this.classList.add('dragover');
    });

    imageDropzone.addEventListener('dragleave', function () {
        this.classList.remove('dragover');
    });

    imageDropzone.addEventListener('drop', function (e) {
        e.preventDefault();
        this.classList.remove('dragover');

        const files = e.dataTransfer.files;
        handleImageFiles(files);
    });

    imageUpload.addEventListener('change', function () {
        handleImageFiles(this.files);
    });

    function handleImageFiles(files) {
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    uploadedImages.push(e.target.result);
                    updateImagePreview();
                };
                reader.readAsDataURL(file);
            }
        }
    }

    function updateImagePreview() {
        imagePreview.innerHTML = '';

        uploadedImages.forEach((src, index) => {
            const container = document.createElement('div');
            container.className = 'upload-preview-item';

            const img = document.createElement('img');
            img.src = src;
            img.className = 'preview-image';

            const removeBtn = document.createElement('div');
            removeBtn.className = 'upload-preview-remove';
            removeBtn.innerHTML = '<i class="fa fa-times"></i>';
            removeBtn.addEventListener('click', function () {
                uploadedImages.splice(index, 1);
                updateImagePreview();
            });

            container.appendChild(img);
            container.appendChild(removeBtn);
            imagePreview.appendChild(container);
        });

        // 更新上传状态
        document.getElementById('uploadCount').textContent = uploadedImages.length;
    }

    // 初始化植物表格
    // 初始化植物表格
    function initPlantTable() {
        plantTableBody.innerHTML = '';

        const currentUser = localStorage.getItem('currentUser');
        const userRole = localStorage.getItem('userRole');
        const isLoggedIn = localStorage.getItem('isLoggedIn');

        // 如果未登录，不显示管理表格
        if (isLoggedIn !== 'true') {
            plantTableBody.innerHTML = `
            <tr>
                <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                    请先登录以管理植物信息
                </td>
            </tr>
        `;
            return;
        }

        // 根据用户角色筛选植物
        let filteredPlants = {};
        if (userRole === 'admin') {
            // 管理员可以看到所有植物
            filteredPlants = plantData;
        } else {
            // 普通用户只能看到自己添加的植物
            Object.keys(plantData).forEach(id => {
                if (plantData[id].createdBy === currentUser) {
                    filteredPlants[id] = plantData[id];
                }
            });
        }

        const totalPlants = Object.keys(filteredPlants).length;
        const totalPages = Math.ceil(totalPlants / itemsPerPage);
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, totalPlants);

        document.getElementById('total-plants-count').textContent = totalPlants;
        updatePaginationInfo(startIndex, endIndex, totalPlants);

        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages;

        updatePageNumbers(totalPages);

        const plantIds = Object.keys(filteredPlants).sort((a, b) => parseInt(a) - parseInt(b));

        if (plantIds.length === 0) {
            plantTableBody.innerHTML = `
            <tr>
                <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                    ${userRole === 'admin' ? '暂无植物数据' : '您还没有添加任何植物'}
                </td>
            </tr>
        `;
            return;
        }

        for (let i = startIndex; i < endIndex; i++) {
            const id = plantIds[i];
            const plant = filteredPlants[id];

            // 权限检查：管理员可以管理所有植物，普通用户只能管理自己创建的植物
            const canEdit = userRole === 'admin' || (currentUser && plant.createdBy === currentUser);

            const row = document.createElement('tr');
            row.className = 'border-b border-gray-100 hover:bg-gray-50';
            row.innerHTML = `
            <td class="px-4 py-3">${id}</td>
            <td class="px-4 py-3">
                <div class="font-medium">${plant.name}</div>
                <div class="text-xs text-gray-500">${plant.scientific}</div>
            </td>
            <td class="px-4 py-3">${plant.category}</td>
            <td class="px-4 py-3">${plant.distribution}</td>
            <td class="px-4 py-3">${plant.createdBy || 'admin'}</td>
            <td class="px-4 py-3">
                <div class="flex space-x-2">
                    ${canEdit ? `<button class="edit-plant text-secondary hover:text-secondary/80 text-sm" data-id="${id}">编辑</button>` : ''}
                    ${canEdit ? `<button class="delete-plant text-red-600 hover:text-red-800 text-sm" data-id="${id}">删除</button>` : ''}
                    ${!canEdit ? `<span class="text-gray-400 text-sm">只读</span>` : ''}
                </div>
            </td>
        `;
            plantTableBody.appendChild(row);
        }

        // 绑定编辑和删除事件
        document.querySelectorAll('.edit-plant').forEach(btn => {
            btn.addEventListener('click', function() {
                const plantId = this.getAttribute('data-id');
                editPlant(plantId);
            });
        });

        document.querySelectorAll('.delete-plant').forEach(btn => {
            btn.addEventListener('click', function() {
                const plantId = this.getAttribute('data-id');
                deletePlant(plantId);
            });
        });
    }

    // 更新页码显示
    function updatePageNumbers(totalPages) {
        pageNumbersContainer.innerHTML = '';

        let startPage = Math.max(1, currentPage - 2);
        let endPage = Math.min(totalPages, startPage + 4);

        if (endPage - startPage < 4) {
            startPage = Math.max(1, endPage - 4);
        }

        for (let i = startPage; i <= endPage; i++) {
            const pageBtn = document.createElement('button');
            pageBtn.className = `page-number ${i === currentPage ? 'active' : ''}`;
            pageBtn.textContent = i;
            pageBtn.addEventListener('click', function () {
                currentPage = i;
                initPlantTable();
            });
            pageNumbersContainer.appendChild(pageBtn);
        }
    }

    // 更新分页信息
    function updatePaginationInfo(start, end, total) {
        const paginationInfo = document.querySelector('.pagination-info');
        paginationInfo.textContent = `显示 ${start + 1}-${end} 项，共 ${total} 项`;
    }

    // 分页按钮事件
    prevPageBtn.addEventListener('click', function () {
        if (currentPage > 1) {
            currentPage--;
            initPlantTable();
        }
    });

    nextPageBtn.addEventListener('click', function () {
        const totalPages = Math.ceil(Object.keys(plantData).length / itemsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            initPlantTable();
        }
    });

    // 更新植物图鉴网格
    function updatePlantsGrid() {
        const plantsGrid = document.getElementById('plantsGrid');
        plantsGrid.innerHTML = '';

        const plantIds = Object.keys(plantData).sort((a, b) => parseInt(a) - parseInt(b));
        const displayIds = plantIds.slice(0, plantsDisplayLimit);

        displayIds.forEach(id => {
            const plant = plantData[id];
            // 使用第一张图片作为卡片图片
            const cardImage = plant.images && plant.images.length > 0 ? plant.images[0] : 'img/default.png';

            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl overflow-hidden shadow-sm card-hover group plant-card';
            card.setAttribute('data-type', plant.category);
            card.setAttribute('data-name', plant.name);
            card.setAttribute('data-family', plant.family);
            card.setAttribute('data-scientific', plant.scientific);

            card.innerHTML = `
                <div class="relative h-56 overflow-hidden">
                    <img src="${cardImage}" alt="${plant.name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                    <div class="absolute top-3 right-3 bg-white/80 backdrop-blur-sm text-primary text-xs font-medium px-2 py-1 rounded plant-type">
                        ${plant.category}
                    </div>
                </div>
                <div class="p-5">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="text-lg font-semibold plant-name">${plant.name}</h3>
                            <span class="text-xs text-gray-500">${plant.scientific}</span>
                        </div>
                    </div>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2 plant-description">${plant.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500"><i class="fa fa-map-marker mr-1"></i> ${plant.distribution}</span>
                        <button class="view-detail-btn text-primary hover:text-primary/80 text-sm font-medium" data-id="${id}">查看详情</button>
                    </div>
                </div>
            `;

            plantsGrid.appendChild(card);
        });

        document.querySelectorAll('.view-detail-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const plantId = this.getAttribute('data-id');
                showPlantDetails(plantId);
            });
        });

        const loadMoreBtn = document.getElementById('loadMoreBtn');
        if (plantsDisplayLimit >= Object.keys(plantData).length) {
            loadMoreBtn.style.display = 'none';
        } else {
            loadMoreBtn.style.display = 'inline-flex';
        }

        filterPlants(currentSearch, currentFilter);
    }

    // 加载更多植物
    document.getElementById('loadMoreBtn').addEventListener('click', function () {
        plantsDisplayLimit += 6;
        updatePlantsGrid();
    });

    // 计算植物统计数据
    function calculatePlantCounts() {
        let counts = {
            total: 0,
            乔木: 0,
            灌木: 0,
            草本: 0,
            藤本: 0,
            蕨类: 0
        };

        Object.keys(plantData).forEach(id => {
            const plant = plantData[id];
            counts.total++;
            counts[plant.category]++;
        });

        return counts;
    }


    function updateTopLocations() {
        const topLocationsContainer = document.getElementById('top-locations');
        topLocationsContainer.innerHTML = '';

        // 统计各区域的植物数量
        const locationCounts = {};

        Object.values(plantData).forEach(plant => {
            const location = plant.location || plant.distribution || '未知区域';
            locationCounts[location] = (locationCounts[location] || 0) + 1;
        });

        // 转换为数组并排序
        const sortedLocations = Object.entries(locationCounts)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3); // 取前3个

        // 生成HTML
        sortedLocations.forEach(([location, count], index) => {
            const li = document.createElement('li');
            li.className = 'flex items-center justify-between';
            li.innerHTML = `
            <span class="flex items-center">
                <span class="w-6 h-6 bg-primary/20 text-primary text-xs rounded-full flex items-center justify-center mr-2">${index + 1}</span>
                ${location}
            </span>
            <span class="text-primary font-medium">${count}种</span>
        `;
            topLocationsContainer.appendChild(li);
        });
    }

    // 新增：更新季节性植物推荐
    function updateSeasonalPlants() {
        const seasonalPlantsContainer = document.getElementById('seasonal-plants');
        seasonalPlantsContainer.innerHTML = '';

        // 获取当前月份
        const currentMonth = new Date().getMonth() + 1;
        let season = '';
        let seasonalPlants = [];

        // 根据月份确定季节
        if (currentMonth >= 3 && currentMonth <= 5) {
            season = '春季';
            // 春季推荐开花植物
            seasonalPlants = Object.values(plantData).filter(plant =>
                ['垂柳', '海棠', '月季', '红花酢浆草', '蒲公英'].includes(plant.name)
            );
        } else if (currentMonth >= 6 && currentMonth <= 8) {
            season = '夏季';
            // 夏季推荐观叶和水生植物
            seasonalPlants = Object.values(plantData).filter(plant =>
                ['莲', '美人蕉', '池杉', '水杉', '竹'].includes(plant.name)
            );
        } else if (currentMonth >= 9 && currentMonth <= 11) {
            season = '秋季';
            // 秋季推荐变色和观果植物
            seasonalPlants = Object.values(plantData).filter(plant =>
                ['无患子', '池杉', '水杉', '鹅掌楸', '榔榆'].includes(plant.name)
            );
        } else {
            season = '冬季';
            // 冬季推荐常绿植物
            seasonalPlants = Object.values(plantData).filter(plant =>
                ['竹', '榔榆', '鹅掌楸', '桑树', '繁缕'].includes(plant.name)
            );
        }

        // 如果没有匹配的植物，显示默认植物
        if (seasonalPlants.length === 0) {
            // 根据季节显示不同的默认植物
            const defaultPlantsBySeason = {
                '春季': ['垂柳', '海棠', '月季'],
                '夏季': ['莲', '美人蕉', '红花酢浆草'],
                '秋季': ['无患子', '池杉', '水杉'],
                '冬季': ['竹', '榔榆', '鹅掌楸']
            };

            const defaultPlantNames = defaultPlantsBySeason[season] || ['垂柳', '海棠', '月季'];

            defaultPlantNames.forEach(plantName => {
                const plant = Object.values(plantData).find(p => p.name === plantName);
                if (plant) {
                    seasonalPlants.push(plant);
                }
            });
        }

        // 只限制数量，不去重（允许同一植物在不同季节出现）
        seasonalPlants = seasonalPlants.slice(0, 6);

        // 生成HTML
        seasonalPlants.forEach(plant => {
            const tag = document.createElement('span');
            tag.className = 'px-3 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors cursor-pointer seasonal-plant-tag';
            tag.textContent = plant.name;
            tag.setAttribute('data-id', Object.keys(plantData).find(id => plantData[id] === plant));

            tag.addEventListener('click', function () {
                const plantId = this.getAttribute('data-id');
                showPlantDetails(plantId);
                document.getElementById('plants').scrollIntoView({behavior: 'smooth'});
            });

            seasonalPlantsContainer.appendChild(tag);
        });

        // 更新季节标题
        const seasonalTitle = document.querySelector('.map-section h3');
        if (seasonalTitle) {
            seasonalTitle.textContent = `${season}推荐植物`;
        }
    }

    // 初始化所有组件
    async function initApp() {
        // 更严格的权限检查
        console.log('开始权限检查...');
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const userRole = localStorage.getItem('userRole');
        const currentUser = localStorage.getItem('currentUser');

        console.log('登录状态:', isLoggedIn);
        console.log('用户角色:', userRole);
        console.log('当前用户:', currentUser);

        // 检查用户权限并显示/隐藏植被管理部分
        checkAdminPermission();

        // 如果是普通用户，显示添加植物按钮
        if (isLoggedIn === 'true' && userRole === 'user') {
            showUserFeatures();
        }

        // 从Supabase获取植物数据
        plantData = await fetchPlantsFromSupabase();

        initPlantTable();
        updatePlantsGrid();
        updatePlantStatistics(calculatePlantCounts());
        setupDetailImagePreview();
        setupQrcodePreview();
        initCarousel();

        updateTopLocations();
        updateSeasonalPlants();
        initPlantTable();
        updatePlantsGrid();

        setTimeout(() => {
            initBaiduMap();
        }, 500);
    }

    // 显示普通用户功能
    function showUserFeatures() {
        const addPlantBtn = document.getElementById('addPlantBtn');
        if (addPlantBtn) {
            addPlantBtn.style.display = 'block';
            addPlantBtn.innerHTML = '<i class="fa fa-plus mr-2"></i> 添加我的植物';
        }

        // 更新管理标题
        const adminTitle = document.querySelector('#admin h2');
        if (adminTitle) {
            adminTitle.textContent = '我的植物管理';
        }

        const adminDesc = document.querySelector('#admin p');
        if (adminDesc) {
            adminDesc.textContent = '管理您添加的植物信息';
        }
    }

    // 检查用户权限并显示/隐藏植被管理部分
    function checkAdminPermission() {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const currentUser = localStorage.getItem('currentUser');
        let userRole = localStorage.getItem('userRole');

        // 如果用户是admin，自动设置为超级管理员
        if (currentUser === 'admin' && userRole === 'admin') {
            userRole = 'super-admin';
            localStorage.setItem('userRole', 'super-admin');
        }

        const adminSection = document.getElementById('admin');
        const adminNavLinks = document.querySelectorAll('.admin-nav-link, .admin-nav-link-mobile, .admin-nav-link-footer');

        console.log('权限检查 - 登录状态:', isLoggedIn, '用户角色:', userRole);

        // 管理员和超级管理员都能看到植被管理
        if (isLoggedIn === 'true' && (userRole === 'admin' || userRole === 'super-admin')) {
            console.log('显示管理员功能');
            if (adminSection) {
                adminSection.style.display = 'block';
                console.log('管理员部分已显示');
            }
            adminNavLinks.forEach(link => {
                link.style.display = 'block';
                console.log('管理员导航链接已显示');
            });
        } else {
            console.log('隐藏管理员功能 - 原因:',
                isLoggedIn !== 'true' ? '未登录' : '不是管理员');
            if (adminSection) {
                adminSection.style.display = 'none';
                console.log('管理员部分已隐藏');
            }
            adminNavLinks.forEach(link => {
                link.style.display = 'none';
                console.log('管理员导航链接已隐藏');
            });
        }
    }

    // 监听页面加载和URL参数
    window.addEventListener('load', function() {
        // 检查URL参数
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('login') === 'success') {
            // 重新初始化应用以刷新权限状态
            setTimeout(initApp, 100);
        } else {
            initApp();
        }
    });

    // 监听存储变化（用于多标签页同步）
    window.addEventListener('storage', function(e) {
        if (e.key === 'isLoggedIn' || e.key === 'userRole') {
            console.log('检测到登录状态变化，重新检查权限');
            checkAdminPermission();
            initPlantTable();
        }
    });
    // 页面加载完成后初始化应用
    window.addEventListener('load', initApp);
</script>
</body>
</html>